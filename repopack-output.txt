This file is a merged representation of the entire codebase, combining all repository files into a single document.
Generated by Repopack on: 2024-12-27T23:29:54.653Z

================================================================
File Summary
================================================================

Purpose:
--------
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.

File Format:
------------
The content is organized as follows:
1. This summary section
2. Repository information
3. Repository structure
4. Multiple file entries, each consisting of:
  a. A separator line (================)
  b. The file path (File: path/to/file)
  c. Another separator line
  d. The full contents of the file
  e. A blank line

Usage Guidelines:
-----------------
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.

Notes:
------
- Some files may have been excluded based on .gitignore rules and Repopack's
  configuration.
- Binary files are not included in this packed representation. Please refer to
  the Repository Structure section for a complete list of file paths, including
  binary files.

Additional Info:
----------------

For more information about Repopack, visit: https://github.com/yamadashy/repopack

================================================================
Repository Structure
================================================================
.gitattributes
.vs/TBLApi/v17/DocumentLayout.backup.json
.vs/TBLApi/v17/DocumentLayout.json
.vs/VSWorkspaceState.json
appsettings.Development.json
appsettings.json
Controllers/BookingController.cs
Controllers/ChatController.cs
Controllers/FavoritesController.cs
Controllers/ReviewController.cs
Controllers/ScheduleController.cs
Controllers/ServicesController.cs
Controllers/TicketsController.cs
Controllers/UsersController.cs
Data/AppDbContext.cs
Migrations/20241223221340_AddReviewsTable.cs
Migrations/20241223221340_AddReviewsTable.Designer.cs
Migrations/AppDbContextModelSnapshot.cs
Models/ActionLog.cs
Models/Booking.cs
Models/Chat.cs
Models/Favorite.cs
Models/LocationUpdateRequest.cs
Models/ModeratorStats.cs
Models/Order.cs
Models/Review.cs
Models/Schedule.cs
Models/Service.cs
Models/UpdateProfileModel.cs
Models/User.cs
obj/Debug/net7.0/.NETCoreApp,Version=v7.0.AssemblyAttributes.cs
obj/Debug/net7.0/TBLApi.AssemblyInfo.cs
obj/Debug/net7.0/TBLApi.AssemblyInfoInputs.cache
obj/Debug/net7.0/TBLApi.GeneratedMSBuildEditorConfig.editorconfig
obj/Debug/net7.0/TBLApi.GlobalUsings.g.cs
Program.cs
Properties/launchSettings.json
Services/IEmailSender.cs
Services/SmtpEmailService.cs
TBLApi.csproj
TBLApi.csproj.user
TBLApi.sln

================================================================
Repository Files
================================================================

================
File: .gitattributes
================
# Auto detect text files and perform LF normalization
* text=auto

================
File: .vs/TBLApi/v17/DocumentLayout.backup.json
================
{
  "Version": 1,
  "WorkspaceRootPath": "C:\\PRODJ\\TBLApi\\",
  "Documents": [
    {
      "AbsoluteMoniker": "D:0:0:{F2F6AAD9-D7E0-4D13-A227-598FEB8056E7}|TBLApi.csproj|c:\\prodj\\tblapi\\controllers\\userscontroller.cs||{A6C744A8-0E4A-4FC6-886A-064283054674}",
      "RelativeMoniker": "D:0:0:{F2F6AAD9-D7E0-4D13-A227-598FEB8056E7}|TBLApi.csproj|solutionrelative:controllers\\userscontroller.cs||{A6C744A8-0E4A-4FC6-886A-064283054674}"
    },
    {
      "AbsoluteMoniker": "D:0:0:{F2F6AAD9-D7E0-4D13-A227-598FEB8056E7}|TBLApi.csproj|c:\\prodj\\tblapi\\controllers\\schedulecontroller.cs||{A6C744A8-0E4A-4FC6-886A-064283054674}",
      "RelativeMoniker": "D:0:0:{F2F6AAD9-D7E0-4D13-A227-598FEB8056E7}|TBLApi.csproj|solutionrelative:controllers\\schedulecontroller.cs||{A6C744A8-0E4A-4FC6-886A-064283054674}"
    },
    {
      "AbsoluteMoniker": "D:0:0:{F2F6AAD9-D7E0-4D13-A227-598FEB8056E7}|TBLApi.csproj|c:\\prodj\\tblapi\\models\\schedule.cs||{A6C744A8-0E4A-4FC6-886A-064283054674}",
      "RelativeMoniker": "D:0:0:{F2F6AAD9-D7E0-4D13-A227-598FEB8056E7}|TBLApi.csproj|solutionrelative:models\\schedule.cs||{A6C744A8-0E4A-4FC6-886A-064283054674}"
    },
    {
      "AbsoluteMoniker": "D:0:0:{F2F6AAD9-D7E0-4D13-A227-598FEB8056E7}|TBLApi.csproj|c:\\prodj\\tblapi\\models\\user.cs||{A6C744A8-0E4A-4FC6-886A-064283054674}",
      "RelativeMoniker": "D:0:0:{F2F6AAD9-D7E0-4D13-A227-598FEB8056E7}|TBLApi.csproj|solutionrelative:models\\user.cs||{A6C744A8-0E4A-4FC6-886A-064283054674}"
    }
  ],
  "DocumentGroupContainers": [
    {
      "Orientation": 0,
      "VerticalTabListWidth": 256,
      "DocumentGroups": [
        {
          "DockedWidth": 200,
          "SelectedChildIndex": 3,
          "Children": [
            {
              "$type": "Bookmark",
              "Name": "ST:128:0:{75188d03-9892-4ae2-abf1-207126247ce5}"
            },
            {
              "$type": "Bookmark",
              "Name": "ST:0:0:{1c4feeaa-4718-4aa9-859d-94ce25d182ba}"
            },
            {
              "$type": "Document",
              "DocumentIndex": 1,
              "Title": "ScheduleController.cs",
              "DocumentMoniker": "C:\\PRODJ\\TBLApi\\Controllers\\ScheduleController.cs",
              "RelativeDocumentMoniker": "Controllers\\ScheduleController.cs",
              "ToolTip": "C:\\PRODJ\\TBLApi\\Controllers\\ScheduleController.cs",
              "RelativeToolTip": "Controllers\\ScheduleController.cs",
              "ViewState": "AgIAABQAAAAAAAAAAAAAwDkAAAAAAAAAAAAAAA==",
              "Icon": "ae27a6b0-e345-4288-96df-5eaf394ee369.000738|",
              "WhenOpened": "2024-12-27T20:24:53.403Z"
            },
            {
              "$type": "Document",
              "DocumentIndex": 0,
              "Title": "UsersController.cs",
              "DocumentMoniker": "C:\\PRODJ\\TBLApi\\Controllers\\UsersController.cs",
              "RelativeDocumentMoniker": "Controllers\\UsersController.cs",
              "ToolTip": "C:\\PRODJ\\TBLApi\\Controllers\\UsersController.cs",
              "RelativeToolTip": "Controllers\\UsersController.cs",
              "ViewState": "AgIAAHABAAAAAAAAAAAiwCcBAAAAAAAAAAAAAA==",
              "Icon": "ae27a6b0-e345-4288-96df-5eaf394ee369.000738|",
              "WhenOpened": "2024-12-26T19:49:26.185Z",
              "EditorCaption": ""
            },
            {
              "$type": "Document",
              "DocumentIndex": 2,
              "Title": "Schedule.cs",
              "DocumentMoniker": "C:\\PRODJ\\TBLApi\\Models\\Schedule.cs",
              "RelativeDocumentMoniker": "Models\\Schedule.cs",
              "ToolTip": "C:\\PRODJ\\TBLApi\\Models\\Schedule.cs",
              "RelativeToolTip": "Models\\Schedule.cs",
              "ViewState": "AgIAADAAAAAAAAAAAAAowGIAAAAAAAAAAAAAAA==",
              "Icon": "ae27a6b0-e345-4288-96df-5eaf394ee369.000738|",
              "WhenOpened": "2024-12-27T20:35:03.036Z"
            },
            {
              "$type": "Document",
              "DocumentIndex": 3,
              "Title": "User.cs",
              "DocumentMoniker": "C:\\PRODJ\\TBLApi\\Models\\User.cs",
              "RelativeDocumentMoniker": "Models\\User.cs",
              "ToolTip": "C:\\PRODJ\\TBLApi\\Models\\User.cs",
              "RelativeToolTip": "Models\\User.cs",
              "ViewState": "AgIAAAcAAAAAAAAAAAAQwBAAAAA+AAAAAAAAAA==",
              "Icon": "ae27a6b0-e345-4288-96df-5eaf394ee369.000738|",
              "WhenOpened": "2024-12-26T19:49:24.544Z"
            }
          ]
        }
      ]
    }
  ]
}

================
File: .vs/TBLApi/v17/DocumentLayout.json
================
{
  "Version": 1,
  "WorkspaceRootPath": "C:\\PRODJ\\TBLApi\\",
  "Documents": [
    {
      "AbsoluteMoniker": "D:0:0:{F2F6AAD9-D7E0-4D13-A227-598FEB8056E7}|TBLApi.csproj|c:\\prodj\\tblapi\\controllers\\userscontroller.cs||{A6C744A8-0E4A-4FC6-886A-064283054674}",
      "RelativeMoniker": "D:0:0:{F2F6AAD9-D7E0-4D13-A227-598FEB8056E7}|TBLApi.csproj|solutionrelative:controllers\\userscontroller.cs||{A6C744A8-0E4A-4FC6-886A-064283054674}"
    },
    {
      "AbsoluteMoniker": "D:0:0:{F2F6AAD9-D7E0-4D13-A227-598FEB8056E7}|TBLApi.csproj|c:\\prodj\\tblapi\\controllers\\schedulecontroller.cs||{A6C744A8-0E4A-4FC6-886A-064283054674}",
      "RelativeMoniker": "D:0:0:{F2F6AAD9-D7E0-4D13-A227-598FEB8056E7}|TBLApi.csproj|solutionrelative:controllers\\schedulecontroller.cs||{A6C744A8-0E4A-4FC6-886A-064283054674}"
    },
    {
      "AbsoluteMoniker": "D:0:0:{F2F6AAD9-D7E0-4D13-A227-598FEB8056E7}|TBLApi.csproj|c:\\prodj\\tblapi\\models\\schedule.cs||{A6C744A8-0E4A-4FC6-886A-064283054674}",
      "RelativeMoniker": "D:0:0:{F2F6AAD9-D7E0-4D13-A227-598FEB8056E7}|TBLApi.csproj|solutionrelative:models\\schedule.cs||{A6C744A8-0E4A-4FC6-886A-064283054674}"
    },
    {
      "AbsoluteMoniker": "D:0:0:{F2F6AAD9-D7E0-4D13-A227-598FEB8056E7}|TBLApi.csproj|c:\\prodj\\tblapi\\models\\user.cs||{A6C744A8-0E4A-4FC6-886A-064283054674}",
      "RelativeMoniker": "D:0:0:{F2F6AAD9-D7E0-4D13-A227-598FEB8056E7}|TBLApi.csproj|solutionrelative:models\\user.cs||{A6C744A8-0E4A-4FC6-886A-064283054674}"
    }
  ],
  "DocumentGroupContainers": [
    {
      "Orientation": 0,
      "VerticalTabListWidth": 256,
      "DocumentGroups": [
        {
          "DockedWidth": 200,
          "SelectedChildIndex": 3,
          "Children": [
            {
              "$type": "Bookmark",
              "Name": "ST:128:0:{75188d03-9892-4ae2-abf1-207126247ce5}"
            },
            {
              "$type": "Bookmark",
              "Name": "ST:0:0:{1c4feeaa-4718-4aa9-859d-94ce25d182ba}"
            },
            {
              "$type": "Document",
              "DocumentIndex": 1,
              "Title": "ScheduleController.cs",
              "DocumentMoniker": "C:\\PRODJ\\TBLApi\\Controllers\\ScheduleController.cs",
              "RelativeDocumentMoniker": "Controllers\\ScheduleController.cs",
              "ToolTip": "C:\\PRODJ\\TBLApi\\Controllers\\ScheduleController.cs",
              "RelativeToolTip": "Controllers\\ScheduleController.cs",
              "ViewState": "AgIAABQAAAAAAAAAAAAAwDkAAAAAAAAAAAAAAA==",
              "Icon": "ae27a6b0-e345-4288-96df-5eaf394ee369.000738|",
              "WhenOpened": "2024-12-27T20:24:53.403Z"
            },
            {
              "$type": "Document",
              "DocumentIndex": 0,
              "Title": "UsersController.cs",
              "DocumentMoniker": "C:\\PRODJ\\TBLApi\\Controllers\\UsersController.cs",
              "RelativeDocumentMoniker": "Controllers\\UsersController.cs",
              "ToolTip": "C:\\PRODJ\\TBLApi\\Controllers\\UsersController.cs",
              "RelativeToolTip": "Controllers\\UsersController.cs",
              "ViewState": "AgIAAKkBAAAAAAAAAAAAACcBAAAAAAAAAAAAAA==",
              "Icon": "ae27a6b0-e345-4288-96df-5eaf394ee369.000738|",
              "WhenOpened": "2024-12-26T19:49:26.185Z",
              "EditorCaption": ""
            },
            {
              "$type": "Document",
              "DocumentIndex": 2,
              "Title": "Schedule.cs",
              "DocumentMoniker": "C:\\PRODJ\\TBLApi\\Models\\Schedule.cs",
              "RelativeDocumentMoniker": "Models\\Schedule.cs",
              "ToolTip": "C:\\PRODJ\\TBLApi\\Models\\Schedule.cs",
              "RelativeToolTip": "Models\\Schedule.cs",
              "ViewState": "AgIAADAAAAAAAAAAAAAowGIAAAAAAAAAAAAAAA==",
              "Icon": "ae27a6b0-e345-4288-96df-5eaf394ee369.000738|",
              "WhenOpened": "2024-12-27T20:35:03.036Z"
            },
            {
              "$type": "Document",
              "DocumentIndex": 3,
              "Title": "User.cs",
              "DocumentMoniker": "C:\\PRODJ\\TBLApi\\Models\\User.cs",
              "RelativeDocumentMoniker": "Models\\User.cs",
              "ToolTip": "C:\\PRODJ\\TBLApi\\Models\\User.cs",
              "RelativeToolTip": "Models\\User.cs",
              "ViewState": "AgIAAAcAAAAAAAAAAAAQwBAAAAA+AAAAAAAAAA==",
              "Icon": "ae27a6b0-e345-4288-96df-5eaf394ee369.000738|",
              "WhenOpened": "2024-12-26T19:49:24.544Z"
            }
          ]
        }
      ]
    }
  ]
}

================
File: .vs/VSWorkspaceState.json
================
{
  "ExpandedNodes": [
    ""
  ],
  "PreviewInSolutionExplorer": false
}

================
File: appsettings.Development.json
================
{
  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Microsoft.AspNetCore": "Warning"
    }
  }
}

================
File: appsettings.json
================
{
  "ConnectionStrings": {
    "DefaultConnection": "Host=junction.proxy.rlwy.net;Port=47042;Database=railway;Username=postgres;Password=PuYeMbjdgtRkBbqeQvkfXThbgaBNNWAr"
  },
  "SmtpSettings": {
    "Server": "smtp.gmail.com",
    "Port": 587,
    "User": "r.w.p.l.d.3@gmail.com",
    "Password": "edht obqg lovk orew"
  },
  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Microsoft.AspNetCore": "Warning"
    }
  },
  "AllowedHosts": "*"
}

================
File: Controllers/BookingController.cs
================
using Microsoft.AspNetCore.Mvc;
using Microsoft.EntityFrameworkCore;
using System.Text.Json;
using TBLApi.Data;
using TBLApi.Models;

namespace TBLApi.Controllers
{
    [ApiController]
    [Route("api/[controller]")]
    public class BookingController : ControllerBase
    {
        private readonly AppDbContext _context;

        public BookingController(AppDbContext context)
        {
            _context = context;
        }

        [HttpPost("book")]
        public async Task<IActionResult> BookTime([FromBody] BookingRequest request)
        {
            try
            {
                Console.WriteLine($"Запрос на бронирование: {JsonSerializer.Serialize(request)}");

                // Поиск расписания
                var schedule = await _context.Schedules
                    .FirstOrDefaultAsync(s => s.SpecialistId == request.SpecialistId && s.Day == request.Day);

                if (schedule == null)
                {
                    return NotFound(new { message = "Расписание не найдено." });
                }

                // Проверка пересечений
                var newInterval = (Start: request.StartTime, End: request.EndTime);
                if (schedule.BookedIntervalsList.Any(booked => booked.Start < newInterval.End && booked.End > newInterval.Start))
                {
                    return Conflict(new { message = "Время уже занято." });
                }

                // Создание записи
                var booking = new Booking
                {
                    SpecialistId = request.SpecialistId,
                    ClientId = request.ClientId,
                    ServiceId = request.ServiceId,
                    Day = request.Day,
                    TimeInterval = $"{request.StartTime:hh\\:mm}-{request.EndTime:hh\\:mm}"
                };

                _context.Bookings.Add(booking);
                await _context.SaveChangesAsync();

                return Ok(new { message = "Время успешно забронировано." });
            }
            catch (Exception ex)
            {
                Console.WriteLine($"Ошибка: {ex.Message}");
                return StatusCode(500, new { message = $"Ошибка при бронировании времени: {ex.Message}" });
            }
        }

        public class BookingRequest
        {
            public int ClientId { get; set; }
            public int SpecialistId { get; set; }
            public int ServiceId { get; set; }
            public DateOnly Day { get; set; } // Чистая дата
            public TimeSpan StartTime { get; set; } // Начало бронирования
            public TimeSpan EndTime { get; set; }
        }

        [HttpGet("specialist/{specialistId}")]
        public async Task<IActionResult> GetBookingsBySpecialist(int specialistId)
        {
            try
            {
                var bookings = await _context.Bookings
                    .Where(b => b.SpecialistId == specialistId)
                    .Include(b => b.Service)
                    .Include(b => b.Client)
                    .ToListAsync();

                var result = bookings.Select(b => new
                {
                    b.Id,
                    b.SpecialistId,
                    b.ClientId,
                    b.ServiceId,
                    b.Day,
                    b.TimeInterval,
                });

                return Ok(result);
            }
            catch (Exception ex)
            {
                return StatusCode(500, new { message = $"Ошибка при получении бронирований: {ex.Message}" });
            }
        }

        [HttpGet("client/{clientId}")]
        public async Task<IActionResult> GetClientMeetings(int clientId)
        {
            try
            {
                var meetings = await _context.Bookings
                    .Where(b => b.ClientId == clientId)
                    .Include(b => b.Service)
                    .Select(b => new
                    {
                        b.Id,
                        b.SpecialistId,
                        b.ClientId,
                        b.ServiceId,
                        b.Day,
                        b.TimeInterval,
                    })
                    .ToListAsync();

                return Ok(meetings);
            }
            catch (Exception ex)
            {
                return StatusCode(500, new { message = $"Ошибка при получении встреч: {ex.Message}" });
            }
        }
    }
}

================
File: Controllers/ChatController.cs
================
using Microsoft.AspNetCore.Mvc;
using Microsoft.EntityFrameworkCore;
using TBLApi.Data;
using TBLApi.Models;

namespace TBLApi.Controllers
{
    [ApiController]
    [Route("api/[controller]")]
    public class ChatsController : ControllerBase
    {
        private readonly AppDbContext _context;

        public ChatsController(AppDbContext context)
        {
            _context = context;
        }

        [HttpPost("create")]
        public async Task<IActionResult> CreateChat([FromBody] CreateChatRequest request)
        {
            if (request.SenderId == request.ReceiverId)
            {
                return BadRequest(new { message = "Нельзя создать чат с самим собой." });
            }

            var existingChat = await _context.Chats
                .FirstOrDefaultAsync(c =>
                    (c.SenderId == request.SenderId && c.ReceiverId == request.ReceiverId) ||
                    (c.SenderId == request.ReceiverId && c.ReceiverId == request.SenderId));

            if (existingChat != null)
            {
                return Ok(existingChat);
            }

            var chat = new Chat
            {
                SenderId = request.SenderId,
                ReceiverId = request.ReceiverId,
                LastMessage = "Chat started",
                Timestamp = DateTime.UtcNow
            };

            _context.Chats.Add(chat);
            await _context.SaveChangesAsync();

            return Ok(chat);
        }

        [HttpDelete("{chatId}")]
        public async Task<IActionResult> DeleteChat(int chatId)
        {
            var chat = await _context.Chats.FindAsync(chatId);
            if (chat == null)
            {
                return NotFound(new { message = "Chat not found." });
            }

            // Удалить сообщения, связанные с чатом
            var messages = _context.Messages.Where(m => m.ChatId == chatId);
            _context.Messages.RemoveRange(messages);

            // Удалить сам чат
            _context.Chats.Remove(chat);

            await _context.SaveChangesAsync();

            return Ok(new { message = "Chat deleted successfully." });
        }


        [HttpGet("{userId}")]
        public async Task<IActionResult> GetChats(int userId)
        {
            var chats = await _context.Chats
                .Where(c => c.SenderId == userId || c.ReceiverId == userId)
                .OrderByDescending(c => c.Timestamp)
                .ToListAsync();

            return Ok(chats);
        }

        [HttpGet("messages/{chatId}")]
        public async Task<IActionResult> GetMessages(int chatId)
        {
            var messages = await _context.Messages
                .Where(m => m.ChatId == chatId)
                .OrderBy(m => m.Timestamp)
                .ToListAsync();

            return Ok(messages);
        }

        [HttpPost("send-message")]
        public async Task<IActionResult> SendMessage([FromBody] Message message)
        {
            if (message == null || message.ChatId <= 0 || string.IsNullOrWhiteSpace(message.Content))
            {
                return BadRequest(new { message = "Некорректные данные сообщения." });
            }

            var chat = await _context.Chats.FindAsync(message.ChatId);
            if (chat == null)
            {
                return NotFound(new { message = "Чат не найден." });
            }

            chat.LastMessage = message.Content;
            chat.Timestamp = DateTime.UtcNow;
            _context.Messages.Add(message);

            try
            {
                await _context.SaveChangesAsync();
                return Ok();
            }
            catch (Exception ex)
            {
                return StatusCode(500, $"Ошибка на сервере: {ex.Message}");
            }
        }

        public class CreateChatRequest
        {
            public int SenderId { get; set; }
            public int ReceiverId { get; set; }
        }

    }
}

================
File: Controllers/FavoritesController.cs
================
using Microsoft.AspNetCore.Mvc;
using Microsoft.EntityFrameworkCore;
using System.ComponentModel.DataAnnotations;
using TBLApi.Data;
using TBLApi.Models;

namespace TBLApi.Controllers
{
    [ApiController]
    [Route("api/[controller]")]
    public class FavoritesController : ControllerBase
    {
        private readonly AppDbContext _context;

        public FavoritesController(AppDbContext context)
        {
            _context = context;
        }

        [HttpGet("{clientId}")]
        public async Task<IActionResult> GetFavorites(int clientId)
        {
            var favorites = await _context.Favorites
        .Include(f => f.Service) // Подгружаем данные услуги
        .Where(f => f.ClientId == clientId)
        .ToListAsync();

            return Ok(favorites);
        }
        [HttpPost("add")]
        public async Task<IActionResult> AddToFavorite([FromBody] Favorite favorite)
        {
            if (favorite.ClientId <= 0 || favorite.ServiceId <= 0)
            {
                return BadRequest("ClientId and ServiceId are required.");
            }

            // Проверка существования клиента и услуги
            var existingClient = await _context.Users.FindAsync(favorite.ClientId);
            var existingService = await _context.Services.FindAsync(favorite.ServiceId);

            if (existingClient == null || existingService == null)
            {
                return NotFound("Client or Service not found.");
            }
            var existingFavorite = await _context.Favorites
        .FirstOrDefaultAsync(f => f.ClientId == favorite.ClientId && f.ServiceId == favorite.ServiceId);

            if (existingFavorite != null)
            {
                // Если запись уже существует, возвращаем ошибку
                return BadRequest(new { message = "The service is already in the favorites." });
            }

            // Обнуляем навигационные свойства
            favorite.Client = null;
            favorite.Service = null;

            _context.Favorites.Add(favorite);
            await _context.SaveChangesAsync();

            return Ok(favorite);
        }

        [HttpDelete("{id}")]
        public async Task<IActionResult> RemoveFromFavorite(int id)
        {
            var favorite = await _context.Favorites.FindAsync(id);
            if (favorite == null) return NotFound();

            _context.Favorites.Remove(favorite);
            await _context.SaveChangesAsync();

            return Ok();
        }
    }
    public class FavoriteDto
    {
        public int ClientId { get; set; }
        public int ServiceId { get; set; }
    }

}

================
File: Controllers/ReviewController.cs
================
using Microsoft.AspNetCore.Mvc;
using Microsoft.EntityFrameworkCore;
using TBLApi.Data;
using TBLApi.Models;

namespace TBLApi.Controllers
{
    [ApiController]
    [Route("api/[controller]")]
    public class ReviewController : ControllerBase
    {
        private readonly AppDbContext _context;

        public ReviewController(AppDbContext context)
        {
            _context = context;
        }

        // Добавление нового отзыва
        [HttpPost]
        public async Task<IActionResult> AddReview([FromBody] Review review)
        {
            if (!ModelState.IsValid) return BadRequest(ModelState);

            review.CreatedAt = DateTime.UtcNow;
            _context.Reviews.Add(review);
            await _context.SaveChangesAsync();

            return Ok(new { message = "Отзыв успешно добавлен." });
        }
        // Получение отзывов по специалисту
        [HttpGet("{specialistId}")]
        public async Task<IActionResult> GetReviewsBySpecialist(int specialistId)
        {
            var reviews = await _context.Reviews
                .Where(r => r.SpecialistId == specialistId)
                .ToListAsync();
            return Ok(reviews);
        }
        [HttpDelete("{id}")]
        public async Task<IActionResult> DeleteReview(int id)
        {
            var review = await _context.Reviews.FindAsync(id);
            if (review == null) return NotFound(new { message = "Отзыв не найден." });

            _context.Reviews.Remove(review);
            await _context.SaveChangesAsync();

            return Ok(new { message = "Отзыв успешно удален." });
        }
    }
}

================
File: Controllers/ScheduleController.cs
================
using Microsoft.AspNetCore.Mvc;
using Microsoft.EntityFrameworkCore;
using TBLApi.Data;
using TBLApi.Models;

namespace TBLApi.Controllers
{
    [Route("api/[controller]")]
    [ApiController]
    public class ScheduleController : ControllerBase
    {
        private readonly AppDbContext _context;

        public ScheduleController(AppDbContext context)
        {
            _context = context;
        }

        [HttpGet("{specialistId}")]
        public async Task<IActionResult> GetScheduleBySpecialist(int specialistId)
        {
            var schedule = await _context.Schedules
                .Where(s => s.SpecialistId == specialistId)
                .ToListAsync();
            return Ok(schedule);
        }

        [HttpPost("add")]
        public async Task<IActionResult> AddOrUpdateSchedule([FromBody] Schedule schedule)
        {
            try
            {
                // Убедитесь, что `Day` был правильно передан и преобразуйте его из строки, если необходимо
                var scheduleDate = schedule.Day;

                var existingSchedule = await _context.Schedules
                    .FirstOrDefaultAsync(s => s.SpecialistId == schedule.SpecialistId && s.Day == scheduleDate);

                if (existingSchedule != null)
                {
                    existingSchedule.StartTime = schedule.StartTime;
                    existingSchedule.EndTime = schedule.EndTime;
                    existingSchedule.BreakDuration = schedule.BreakDuration;
                }
                else
                {
                    _context.Schedules.Add(schedule);
                }

                await _context.SaveChangesAsync();
                return Ok(new { message = "Расписание успешно добавлено или обновлено." });
            }
            catch (Exception ex)
            {
                return BadRequest($"Ошибка при добавлении или обновлении расписания: {ex.Message}");
            }
        }


        [HttpDelete("{id}")]
        public async Task<IActionResult> DeleteSchedule(int id)
        {
            var schedule = await _context.Schedules.FindAsync(id);

            if (schedule == null)
                return NotFound(new { message = "Расписание не найдено." });

            _context.Schedules.Remove(schedule);
            await _context.SaveChangesAsync();

            return Ok(new { message = "Расписание удалено." });
        }
        [HttpGet("specialist/{id}/available-intervals")]
        public async Task<IActionResult> GetAvailableIntervals(int id)
        {
            try
            {
                var schedule = await _context.Schedules
                    .Where(s => s.SpecialistId == id)
                    .ToListAsync();

                if (!schedule.Any())
                    return NotFound(new { message = "Расписание не найдено." });

                var availableIntervals = schedule.Select(s => new
                {
                    s.Day,
                    s.StartTime,
                    s.EndTime,
                    s.BreakDuration,
                    AvailableIntervals = s.AvailableIntervals // Доступные интервалы
                });

                return Ok(availableIntervals);
            }
            catch (Exception ex)
            {
                return StatusCode(500, $"Ошибка при получении интервалов: {ex.Message}");
            }
        }

    }
}

================
File: Controllers/ServicesController.cs
================
using Microsoft.AspNetCore.Mvc;
using Microsoft.EntityFrameworkCore;
using TBLApi.Data;
using TBLApi.Models;

[Route("api/[controller]")]
[ApiController]
public class ServicesController : ControllerBase
{
    private readonly AppDbContext _context;

    public ServicesController(AppDbContext context)
    {
        _context = context;
    }

    [HttpPost("add")]
    public async Task<IActionResult> AddService([FromBody] ServiceModel service)
    {
        if (!ModelState.IsValid)
            return BadRequest(ModelState);

        _context.Services.Add(service);
        await _context.SaveChangesAsync();

        return Ok(new { message = "Услуга добавлена.", service });
    }

    [HttpPut("update-service/{id}")]
    public async Task<IActionResult> UpdateService(int id, [FromBody] ServiceModel updatedService)
    {
        var service = await _context.Services.FindAsync(id);
        if (service == null) return NotFound(new { message = "Service not found." });

        service.SpecialistName = updatedService.SpecialistName ?? service.SpecialistName;
        service.Title = updatedService.Title ?? service.Title;
        service.Description = updatedService.Description ?? service.Description;
        service.Price = updatedService.Price != 0 ? updatedService.Price : service.Price;

        _context.Services.Update(service);
        await _context.SaveChangesAsync();

        return Ok(new { message = "Service updated successfully." });
    }
    [HttpPut("update/{id}")]
    public async Task<IActionResult> UpdateSchedule(int id, [FromBody] Schedule updatedSchedule)
    {
        var schedule = await _context.Schedules.FindAsync(id);
        if (schedule == null)
            return NotFound(new { message = "График не найден." });

        schedule.WorkingHours = updatedSchedule.WorkingHours;
        schedule.BookedIntervals = updatedSchedule.BookedIntervals;

        _context.Schedules.Update(schedule);
        await _context.SaveChangesAsync();

        return Ok(new { message = "График обновлён." });
    }
 
    [HttpDelete("delete/{id}")]
    public async Task<IActionResult> DeleteService(int id)
    {
        try
        {
            var service = await _context.Services.FindAsync(id);
            if (service == null)
            {
                return NotFound(new { message = "Услуга не найдена." });
            }

            // Вызов функции каскадного удаления
            await _context.Database.ExecuteSqlInterpolatedAsync($"SELECT delete_service_cascade({id})");

            return Ok(new { message = "Услуга успешно удалена." });
        }
        catch (Exception ex)
        {
            return StatusCode(500, $"Ошибка при удалении услуги: {ex.Message}");
        }
    }
    // Получить услуги специалиста
    [HttpGet("specialist/{specialistId}")]
    public async Task<IActionResult> GetServicesBySpecialist(int specialistId)
    {
        var services = await _context.Services
            .Where(s => s.SpecialistId == specialistId)
            .ToListAsync();

        if (!services.Any())
        {
            return NotFound(new { message = "No services found for this specialist." });
        }

        return Ok(new { data = services });
    }

    [HttpGet("{serviceId}")]
    public async Task<IActionResult> GetServiceById(int serviceId)
    {
        var service = await _context.Services.FindAsync(serviceId);

        if (service == null)
        {
            return NotFound(new { Message = $"Service with ID {serviceId} not found." });
        }

        return Ok(service);
    }

    [HttpGet("search")]
    public async Task<IActionResult> SearchServices(string query, string city)
    {
        Console.WriteLine($"Поиск: query='{query}', city='{city}'");

        var services = await _context.Services
            .Where(s => EF.Functions.ILike(s.Title, $"%{query}%") && s.City == city)
            .ToListAsync();

        if (!services.Any())
        {
            Console.WriteLine("Услуги не найдены.");
            return NotFound(new { message = "No services found in this city." });
        }

        Console.WriteLine($"Найдено {services.Count} услуг.");
        return Ok(services);
    }


}

================
File: Controllers/TicketsController.cs
================
using Microsoft.AspNetCore.Mvc;
using System.Net.Sockets;
using Microsoft.EntityFrameworkCore;
using TBLApi.Data;
using TBLApi.Models;
using Org.BouncyCastle.Asn1.Ocsp;

[ApiController]
[Route("api/Tickets")]
public class TicketController : ControllerBase
{
    private readonly AppDbContext _context;

    public TicketController(AppDbContext context)
    {
        _context = context;
    }

    // Создать тикет
    [HttpPost]
    public async Task<IActionResult> CreateTicket([FromBody] Ticket ticket)
    {
        if (ticket == null)
        {
            return BadRequest("Ticket is required.");
        }

        try
        {
            _context.Tickets.Add(ticket);
            await _context.SaveChangesAsync();
            return Ok(ticket);
        }
        catch (Exception ex)
        {
            return StatusCode(500, $"Error creating ticket: {ex.Message} | Inner Exception: {ex.InnerException?.Message}");
        }
    }

    // Получить все тикеты (для модераторов)
    [HttpGet]
    public async Task<IActionResult> GetTickets()
    {
        try
        {
            var tickets = await _context.Tickets
                .Select(t => new Ticket
                {
                    Id = t.Id,
                    UserId = t.UserId,
                    TargetId = t.TargetId,
                    Comment = t.Comment,
                    Status = t.Status,
                    CreatedAt = t.CreatedAt,
                    ModeratorId = t.ModeratorId,
                    ActionTaken = t.ActionTaken,
                })
                .ToListAsync();

            return Ok(tickets);
        }
        catch (Exception ex)
        {
            return StatusCode(500, $"Ошибка при получении тикетов: {ex.Message}");
        }
    }

    [HttpGet("{id}")]
    public async Task<IActionResult> GetTicketById(int id)
    {
        try
        {
            // Ищем тикет по его ID
            var ticket = await _context.Tickets.FirstOrDefaultAsync(t => t.Id == id);
            if (ticket == null)
            {
                return NotFound($"Тикет с ID {id} не найден.");
            }

            // Формируем расширенный ответ, если нужно
            var response = new
            {
                ticket.Id,
                ticket.UserId,
                ticket.TargetId,
                ticket.Comment,
                ticket.Status,
                ticket.CreatedAt,
                ticket.ModeratorId,
                ticket.ActionTaken,
                ComplainantName = _context.Users.FirstOrDefault(u => u.Id == ticket.UserId)?.Name,
                ComplainantPhoto = _context.Users.FirstOrDefault(u => u.Id == ticket.UserId)?.PhotoBase64,
                TargetName = _context.Users.FirstOrDefault(u => u.Id == ticket.TargetId)?.Name,
                TargetPhoto = _context.Users.FirstOrDefault(u => u.Id == ticket.TargetId)?.PhotoBase64
            };

            return Ok(response);
        }
        catch (Exception ex)
        {
            return StatusCode(500, $"Ошибка при получении тикета: {ex.Message}");
        }
    }



    // Обновить тикет (действие модератора)
    [HttpPut("{id}")]
    public async Task<IActionResult> UpdateTicket(int id, [FromBody] Ticket updatedTicket)
    {
        try
        {
            var ticket = await _context.Tickets.FindAsync(id);
            if (ticket == null) return NotFound();

            ticket.Status = updatedTicket.Status;
            ticket.ActionTaken = updatedTicket.ActionTaken;

            // Обновляем статистику модератора
            var moderatorId = updatedTicket.ModeratorId; // Используем ModeratorId из объекта updatedTicket
            var statistic = await _context.ModeratorStatistics.FirstOrDefaultAsync(m => m.ModeratorId == moderatorId);

            if (statistic == null)
            {
                statistic = new ModeratorStatistic
                {
                    ModeratorId = moderatorId
                };
                _context.ModeratorStatistics.Add(statistic);
            }

            switch (updatedTicket.ActionTaken)
            {
                case "Заблокировать":
                    statistic.BlockedProfiles++;
                    break;
                case "Ограничение":
                    statistic.RestrictedProfiles++;
                    break;
            }

            if (updatedTicket.Status == "Отклонено")
            {
                statistic.RejectedTickets++;
            }
            else if (updatedTicket.Status == "Закрыто")
            {
                statistic.ClosedTickets++;
            }

            await _context.SaveChangesAsync();
            return Ok(ticket);
        }
        catch (Exception ex)
        {
            return StatusCode(500, $"Ошибка при обновлении тикета: {ex.Message}");
        }
    }

    // Удалить тикет
    [HttpDelete("{id}")]
    public async Task<IActionResult> DeleteTicket(int id)
    {
        try
        {
            var ticket = await _context.Tickets.FindAsync(id);
            if (ticket == null) return NotFound();

            _context.Tickets.Remove(ticket);
            await _context.SaveChangesAsync();
            return Ok();
        }
        catch (Exception ex)
        {
            return StatusCode(500, $"Ошибка при удалении тикета: {ex.Message}");
        }
    }
}

================
File: Controllers/UsersController.cs
================
using Microsoft.AspNetCore.Mvc;
using Microsoft.EntityFrameworkCore;
using TBLApi.Data;
using TBLApi.Models;
using TBLApi.Services;
using Microsoft.AspNetCore.Identity;
using Microsoft.Extensions.Logging;

namespace TBLApi.Controllers
{
    [Route("api/[controller]")]
    [ApiController]
    public class UsersController : ControllerBase
    {
        private readonly AppDbContext _context;
        private readonly IEmailSender _emailSender;
        private readonly ILogger<UsersController> _logger;

        public UsersController(AppDbContext context, IEmailSender emailSender, ILogger<UsersController> logger)
        {
            _context = context;
            _emailSender = emailSender;
            _logger = logger;
        }

        [HttpPost("register")]
        public async Task<IActionResult> Register([FromBody] User user)
        {
            if (await _context.Users.AnyAsync(u => u.Email == user.Email))
            {
                return BadRequest(new { message = "Email is already registered." });
            }

            user.Password = BCrypt.Net.BCrypt.HashPassword(user.Password);
            user.EmailConfirmationToken = Guid.NewGuid().ToString();

            _context.Users.Add(user);
            await _context.SaveChangesAsync();

            var confirmationLink = $"{Request.Scheme}://{Request.Host}/api/users/confirm-email/{user.EmailConfirmationToken}";
            await _emailSender.SendEmailAsync(
                user.Email,
                "Confirm your email",
                $"Click <a href='{confirmationLink}'>here</a> to confirm your email."
            );

            return Ok(new { message = "Registration successful. Please confirm your email." });
        }

        [HttpPost("send-email")]
        public async Task<IActionResult> SendEmail([FromBody] EmailRequest model)
        {
            if (string.IsNullOrWhiteSpace(model.To) || string.IsNullOrWhiteSpace(model.Subject) || string.IsNullOrWhiteSpace(model.Body))
            {
                return BadRequest("All fields (To, Subject, Body) must be provided.");
            }

            await _emailSender.SendEmailAsync(model.To, model.Subject, model.Body);
            return Ok(new { message = "Email sent successfully." });
        }

        [HttpGet("confirm-email/{token}")]
        public async Task<IActionResult> ConfirmEmail(string token)
        {
            var user = await _context.Users.FirstOrDefaultAsync(u => u.EmailConfirmationToken == token);
            if (user == null)
            {
                return BadRequest(new { message = "Invalid confirmation token." });
            }

            user.IsEmailConfirmed = true;
            user.EmailConfirmationToken = null;

            _context.Users.Update(user);
            await _context.SaveChangesAsync();

            return Ok(new { message = "Email confirmed successfully!" });
        }

        [HttpPost("login")]
        public async Task<IActionResult> Login(LoginRequestModel model)
        {
            var user = await _context.Users.FirstOrDefaultAsync(u => u.Username == model.Login || u.Email == model.Login);

            if (user == null || !BCrypt.Net.BCrypt.Verify(model.Password, user.Password))
            {
                return Unauthorized(new { message = "Invalid login or password." });
            }

            if (!user.IsEmailConfirmed)
            {
                return Unauthorized(new { message = "Please verify your email" });
            }

            return Ok(new { user.Id, user.Username, user.Email, user.Role, user.Description, user.City, user.IsEmailConfirmed, user.PhotoBase64 });
        }

        [HttpPost("send-password-reset")]
        public async Task<IActionResult> SendPasswordReset([FromBody] PasswordResetRequestModel model)
        {
            var user = await _context.Users.FirstOrDefaultAsync(u => u.Email == model.Email);
            if (user == null)
            {
                return NotFound(new { message = "No user found with the specified email." });
            }

            user.PasswordResetToken = Guid.NewGuid().ToString();
            user.PasswordResetExpiration = DateTime.UtcNow.AddHours(1);

            _context.Users.Update(user);
            await _context.SaveChangesAsync();

            var resetUrl = $"{Request.Scheme}://{Request.Host}/api/Users/reset-password/{user.PasswordResetToken}";
            await _emailSender.SendEmailAsync(user.Email, "Reset your password", $"Click <a href='{resetUrl}'>here</a> to reset your password.");

            return Ok(new { message = "Password reset email sent." });
        }
        [HttpPost("reset-password")]
        public async Task<IActionResult> ResetPassword([FromBody] ResetPasswordDto model)
        {
            _logger.LogInformation("Начат процесс сброса пароля.");

            if (string.IsNullOrWhiteSpace(model.Token) || string.IsNullOrWhiteSpace(model.NewPassword) )
            {
                _logger.LogWarning("Токен или новый пароль не были предоставлены.");
                return BadRequest(new { message = "Токен и новый пароль обязательны." });
            }

            var user = await _context.Users
                .FirstOrDefaultAsync(u => u.PasswordResetToken == model.Token && u.PasswordResetExpiration > DateTime.UtcNow);

            if (user == null)
            {
                _logger.LogWarning("Неверный или истёкший токен для сброса пароля. Токен: {Token}", model.Token);
                return BadRequest(new { message = "Неверный или истёкший токен." });
            }

            try
            {
                // Хэшируем новый пароль
                user.Password = BCrypt.Net.BCrypt.HashPassword(model.NewPassword);
                user.PasswordResetToken = null;
                user.PasswordResetExpiration = null;

                _logger.LogInformation("Пароль для пользователя с ID {UserId} успешно обновлён.", user.Id);

                await _context.SaveChangesAsync();

                _logger.LogInformation("Изменения сохранены в базе данных.");
                return Ok(new { message = "Пароль успешно сброшен." });
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, "Ошибка при сбросе пароля для пользователя с токеном: {Token}", model.Token);
                return StatusCode(500, new { message = "Произошла ошибка при сбросе пароля. Пожалуйста, попробуйте позже." });
            }
        }

        [HttpGet("reset-password/{token}")]
        public IActionResult ResetPassword(string token)
        {
            // Генерация ссылки для приложения
            var deepLinkUrl = $"myapp://reset-password?token={token}";

            // Перенаправляем пользователя в приложение
            return Redirect(deepLinkUrl);
        }


        [HttpPut("update-avatar/{id}")]
        public async Task<IActionResult> UpdateAvatar(int id, [FromBody] PhotoUploadRequest request)
        {
            var user = await _context.Users.FindAsync(id);

            if (user == null)
            {
                return NotFound(new { message = "User not found." });
            }

            user.PhotoBase64 = request.PhotoBase64;
            _context.Users.Update(user);
            await _context.SaveChangesAsync();

            return Ok(new { message = "Avatar updated successfully." });
        }
        [HttpGet("all")]
        public async Task<IActionResult> GetAllUsers()
        {
            var users = await _context.Users.ToListAsync();
            return Ok(users);
        }
        [HttpGet("logs")]
        public async Task<IActionResult> GetActionLogs()
        {
            var logs = await _context.ActionLogs
                .Include(log => log.User) // Если требуется информация о пользователе
                .OrderByDescending(log => log.Timestamp)
                .ToListAsync();

            return Ok(logs);
        }

        [HttpGet("{id}")]
        public async Task<IActionResult> GetUserById(int id)
        {
            var user = await _context.Users.FindAsync(id);
            if (user == null)
            {
                return NotFound(new { message = "Пользователь не найден" });
            }
            return Ok(user);
        }

        // Получение логов по UserId
        [HttpGet("user/{userId}")]
        public async Task<IActionResult> GetLogsByUser(int userId)
        {
            var logs = await _context.ActionLogs
                .Where(log => log.UserId == userId)
                .OrderByDescending(log => log.Timestamp)
                .ToListAsync();

            if (!logs.Any())
            {
                return NotFound(new { message = $"No logs found for User ID {userId}." });
            }

            return Ok(logs);
        }
        [HttpPut("update-profile/{id}")]
        public async Task<IActionResult> UpdateProfile(int id, [FromBody] UpdateProfileModel model)
        {
            // Найти пользователя в базе данных
            var user = await _context.Users.FindAsync(id);
            if (user == null)
            {
                return NotFound(new { message = "User not found" });
            }

            // Обновление данных, только если они указаны в запросе
            user.Username = !string.IsNullOrEmpty(model.Username) ? model.Username : user.Username;
            user.Password = !string.IsNullOrEmpty(model.Password) ? model.Password : user.Password;
            user.Email = !string.IsNullOrEmpty(model.Email) ? model.Email : user.Email;
            user.Role = !string.IsNullOrEmpty(model.Role) ? model.Role : user.Role;
            user.Name = !string.IsNullOrEmpty(model.Name) ? model.Name : user.Name;
            user.City = !string.IsNullOrEmpty(model.City) ? model.City : user.City;
            user.Description = !string.IsNullOrEmpty(model.Description) ? model.Description : user.Description;

            // Сохранение изменений
            await _context.SaveChangesAsync();

            return Ok(new { message = "Profile updated successfully", user });
        }
        [HttpGet("Specialists/{specialistId}")]
        public async Task<IActionResult> GetSpecialistById(int specialistId)
        {
            var specialist = await _context.Users // Или другая таблица
                .FirstOrDefaultAsync(u => u.Id == specialistId && u.Role == "Specialist");

            if (specialist == null)
            {
                return NotFound(new { message = "Specialist not found." });
            }

            return Ok(specialist);
        }
        [HttpGet("{moderatorId}/statistics")]
        public async Task<IActionResult> GetStatistics(int moderatorId)
        {
            var statistic = await _context.ModeratorStatistics
                .FirstOrDefaultAsync(m => m.ModeratorId == moderatorId);

            if (statistic == null)
            {
                return NotFound("Statistics not found.");
            }

            return Ok(statistic);
        }

        [HttpPost("statistics")]
        public async Task<IActionResult> CreateStatistics(ModeratorStatistic stats)
        {
            try
            {
                // Add statistics to the database
                _context.ModeratorStatistics.Add(stats);
                await _context.SaveChangesAsync();
                return Ok(stats);
            }
            catch (Exception ex)
            {
                return StatusCode(500, $"Error while creating statistics: {ex.Message}");
            }
        }


        [HttpDelete("{userId}/block")]
        public async Task<IActionResult> DeleteUser(int userId)
        {
            try
            {
                // Найти пользователя в базе данных
                var user = await _context.Users.FindAsync(userId);
                if (user == null)
                {
                    return NotFound(new { message = "Пользователь не найден." });
                }

                // Удаление пользователя из базы данных
                _context.Users.Remove(user);
                // Вызов процедуры через SQL-запрос
                await _context.Database.ExecuteSqlRawAsync($"SELECT public.delete_user_and_dependencies_function({userId});");

                return Ok(new { message = "Пользователь успешно удален." });
            }
            catch (Exception ex)
            {
                return StatusCode(500, new { message = "Ошибка при удалении пользователя.", details = ex.Message });
            }
        }
        [HttpPut("{id}/update-location")]
        public async Task<IActionResult> UpdateLocation(int id, [FromBody] LocationUpdateRequest request)
        {
            var user = await _context.Users.FindAsync(id);

            if (user == null)
            {
                return NotFound(new { message = "Пользователь не найден." });
            }

            user.Latitude = request.Latitude;
            user.Longitude = request.Longitude;
            user.Address = request.Address;

            _context.Users.Update(user);
            await _context.SaveChangesAsync();

            return Ok(new { message = "Местоположение обновлено." });
        }

        [HttpGet("{id}/location")]
        public async Task<IActionResult> GetLocation(int id)
        {
            var user = await _context.Users
                .Where(u => u.Id == id)
                .Select(u => new
                {
                    u.Latitude,
                    u.Longitude,
                    u.Address
                })
                .FirstOrDefaultAsync();

            if (user == null)
            {
                return NotFound(new { message = "Пользователь не найден." });
            }

            return Ok(user);
        }
        [HttpPost("update")]
        public async Task<IActionResult> UpdateModeratorStatistics([FromBody] StatisticsUpdateRequest request)
        {
            try
            {
                // Проверяем существование статистики
                var stats = await _context.ModeratorStatistics
                    .FirstOrDefaultAsync(s => s.ModeratorId == request.ModeratorId);

                if (stats == null)
                {
                    // Создаём новую статистику, если её нет
                    stats = new ModeratorStatistic
                    {
                        ModeratorId = request.ModeratorId,
                        BlockedProfiles = 0,
                        ClosedTickets = 0,
                        RejectedTickets = 0,
                        RestrictedProfiles = 0
                    };
                    _context.ModeratorStatistics.Add(stats);
                    await _context.SaveChangesAsync();
                }

                // Обновляем нужное поле
                switch (request.Field)
                {
                    case "BlockedProfiles":
                        stats.BlockedProfiles += request.IncrementBy;
                        break;
                    case "ClosedTickets":
                        stats.ClosedTickets += request.IncrementBy;
                        break;
                    case "RejectedTickets":
                        stats.RejectedTickets += request.IncrementBy;
                        break;
                    case "RestrictedProfiles":
                        stats.RestrictedProfiles += request.IncrementBy;
                        break;
                    default:
                        return BadRequest("Invalid field");
                }

                // Сохраняем изменения
                await _context.SaveChangesAsync();
                return Ok(stats);
            }
            catch (Exception ex)
            {
                return StatusCode(500, $"Failed to update statistics: {ex.Message}");
            }
        }


        public class StatisticsUpdateRequest
        {
            public int ModeratorId { get; set; }
            public string Field { get; set; }
            public int IncrementBy { get; set; }
        }

        public class ResetPasswordDto
        {
            public string Token { get; set; }
            public string NewPassword { get; set; }
        }

        public class PhotoUploadRequest
        {
            public string PhotoBase64 { get; set; }
        }

        public class PasswordResetRequestModel
        {
            public string Email { get; set; }
        }

        public class PasswordResetModel
        {
            public string NewPassword { get; set; }
        }

        public class LoginRequestModel
        {
            public string Login { get; set; }
            public string Password { get; set; }
        }

        public class EmailRequest
        {
            public string To { get; set; }
            public string Subject { get; set; }
            public string Body { get; set; }
        }
        public class UpdatePasswordRequest
        {
            public string Token { get; set; }
            public string NewPassword { get; set; }
        }
    }
}

================
File: Data/AppDbContext.cs
================
using Microsoft.EntityFrameworkCore;
using TBLApi.Models;

namespace TBLApi.Data
{
    public class AppDbContext : DbContext
    {
        public AppDbContext(DbContextOptions<AppDbContext> options) : base(options) { }

        public DbSet<User> Users { get; set; }
        public DbSet<ServiceModel> Services { get; set; }
        public DbSet<Schedule> Schedules { get; set; }
        public DbSet<Favorite> Favorites { get; set; }
        public DbSet<Message> Messages { get; set; }
        public DbSet<ActionLog> ActionLogs { get; set; }
        public DbSet<Ticket> Tickets { get; set; }
        public DbSet<Review> Reviews { get; set; }
        public DbSet<Chat> Chats { get; set; }
        public DbSet<Booking> Bookings { get; set; }
        public DbSet<ModeratorStatistic> ModeratorStatistics { get; set; }

        protected override void OnModelCreating(ModelBuilder modelBuilder)
        {
            base.OnModelCreating(modelBuilder);

            modelBuilder.Entity<Review>()
                .HasOne(r => r.Specialist)
                .WithMany()
                .HasForeignKey(r => r.SpecialistId)
                .OnDelete(DeleteBehavior.Restrict);

            // Настройки для Chat
            modelBuilder.Entity<Chat>()
                .HasOne(c => c.Sender)
                .WithMany()
                .HasForeignKey(c => c.SenderId)
                .OnDelete(DeleteBehavior.Restrict);

            modelBuilder.Entity<Chat>()
                .HasOne(c => c.Receiver)
                .WithMany()
                .HasForeignKey(c => c.ReceiverId)
                .OnDelete(DeleteBehavior.Restrict);

            modelBuilder.Entity<Favorite>()
        .HasOne(f => f.Client)
        .WithMany(c => c.Favorites)
        .HasForeignKey(f => f.ClientId)
        .OnDelete(DeleteBehavior.Cascade);

            modelBuilder.Entity<Favorite>()
                .HasOne(f => f.Service)
                .WithMany(s => s.Favorites)
                .HasForeignKey(f => f.ServiceId)
                .OnDelete(DeleteBehavior.Cascade);

            modelBuilder.Entity<Booking>()
    .HasOne(b => b.Service) // Связь с Service
    .WithMany(s => s.Bookings)
    .HasForeignKey(b => b.ServiceId)
    .OnDelete(DeleteBehavior.Cascade);

            modelBuilder.Entity<Booking>()
                .HasOne(b => b.Client) // Связь с User (клиентом)
                .WithMany()
                .HasForeignKey(b => b.ClientId)
                .OnDelete(DeleteBehavior.Restrict);

        }
    }
}

================
File: Migrations/20241223221340_AddReviewsTable.cs
================
using System;
using Microsoft.EntityFrameworkCore.Migrations;
using Npgsql.EntityFrameworkCore.PostgreSQL.Metadata;

#nullable disable

namespace TBLApi.Migrations
{
    /// <inheritdoc />
    public partial class AddReviewsTable : Migration
    {
        /// <inheritdoc />
        protected override void Up(MigrationBuilder migrationBuilder)
        {
            migrationBuilder.CreateTable(
                name: "Messages",
                columns: table => new
                {
                    Id = table.Column<int>(type: "integer", nullable: false)
                        .Annotation("Npgsql:ValueGenerationStrategy", NpgsqlValueGenerationStrategy.IdentityByDefaultColumn),
                    ChatId = table.Column<int>(type: "integer", nullable: false),
                    SenderId = table.Column<int>(type: "integer", nullable: false),
                    ReceiverId = table.Column<int>(type: "integer", nullable: false),
                    Content = table.Column<string>(type: "text", nullable: false),
                    Timestamp = table.Column<DateTime>(type: "timestamp with time zone", nullable: false)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_Messages", x => x.Id);
                });

            migrationBuilder.CreateTable(
                name: "ModeratorStatistics",
                columns: table => new
                {
                    Id = table.Column<int>(type: "integer", nullable: false)
                        .Annotation("Npgsql:ValueGenerationStrategy", NpgsqlValueGenerationStrategy.IdentityByDefaultColumn),
                    ModeratorId = table.Column<int>(type: "integer", nullable: false),
                    ClosedTickets = table.Column<int>(type: "integer", nullable: false),
                    BlockedProfiles = table.Column<int>(type: "integer", nullable: false),
                    RestrictedProfiles = table.Column<int>(type: "integer", nullable: false),
                    RejectedTickets = table.Column<int>(type: "integer", nullable: false)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_ModeratorStatistics", x => x.Id);
                });

            migrationBuilder.CreateTable(
                name: "Schedules",
                columns: table => new
                {
                    Id = table.Column<int>(type: "integer", nullable: false)
                        .Annotation("Npgsql:ValueGenerationStrategy", NpgsqlValueGenerationStrategy.IdentityByDefaultColumn),
                    SpecialistId = table.Column<int>(type: "integer", nullable: false),
                    Day = table.Column<DateTime>(type: "timestamp with time zone", nullable: false),
                    WorkingHours = table.Column<string>(type: "text", nullable: false),
                    BookedIntervals = table.Column<string>(type: "text", nullable: false)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_Schedules", x => x.Id);
                });

            migrationBuilder.CreateTable(
                name: "Services",
                columns: table => new
                {
                    Id = table.Column<int>(type: "integer", nullable: false)
                        .Annotation("Npgsql:ValueGenerationStrategy", NpgsqlValueGenerationStrategy.IdentityByDefaultColumn),
                    Title = table.Column<string>(type: "text", nullable: false),
                    Description = table.Column<string>(type: "text", nullable: false),
                    Price = table.Column<decimal>(type: "numeric", nullable: false),
                    SpecialistId = table.Column<int>(type: "integer", nullable: false),
                    City = table.Column<string>(type: "text", nullable: false),
                    SpecialistName = table.Column<string>(type: "text", nullable: false)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_Services", x => x.Id);
                });

            migrationBuilder.CreateTable(
                name: "Tickets",
                columns: table => new
                {
                    Id = table.Column<int>(type: "integer", nullable: false)
                        .Annotation("Npgsql:ValueGenerationStrategy", NpgsqlValueGenerationStrategy.IdentityByDefaultColumn),
                    UserId = table.Column<int>(type: "integer", nullable: false),
                    TargetId = table.Column<int>(type: "integer", nullable: false),
                    Comment = table.Column<string>(type: "text", nullable: false),
                    Status = table.Column<string>(type: "text", nullable: false),
                    CreatedAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: false),
                    ModeratorId = table.Column<int>(type: "integer", nullable: false),
                    ActionTaken = table.Column<string>(type: "text", nullable: false)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_Tickets", x => x.Id);
                });

            migrationBuilder.CreateTable(
                name: "Users",
                columns: table => new
                {
                    Id = table.Column<int>(type: "integer", nullable: false)
                        .Annotation("Npgsql:ValueGenerationStrategy", NpgsqlValueGenerationStrategy.IdentityByDefaultColumn),
                    Username = table.Column<string>(type: "text", nullable: false),
                    Password = table.Column<string>(type: "text", nullable: false),
                    Email = table.Column<string>(type: "text", nullable: false),
                    PhotoBase64 = table.Column<string>(type: "text", nullable: true),
                    LinkToProfile = table.Column<string>(type: "text", nullable: true),
                    Name = table.Column<string>(type: "text", nullable: true),
                    City = table.Column<string>(type: "text", nullable: true),
                    Role = table.Column<string>(type: "text", nullable: false),
                    Description = table.Column<string>(type: "text", nullable: true),
                    IsEmailConfirmed = table.Column<bool>(type: "boolean", nullable: false),
                    EmailConfirmationToken = table.Column<string>(type: "text", nullable: true),
                    PasswordResetToken = table.Column<string>(type: "text", nullable: true),
                    PasswordResetExpiration = table.Column<DateTime>(type: "timestamp with time zone", nullable: true)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_Users", x => x.Id);
                });

            migrationBuilder.CreateTable(
                name: "ActionLogs",
                columns: table => new
                {
                    Id = table.Column<int>(type: "integer", nullable: false)
                        .Annotation("Npgsql:ValueGenerationStrategy", NpgsqlValueGenerationStrategy.IdentityByDefaultColumn),
                    UserId = table.Column<int>(type: "integer", nullable: true),
                    Action = table.Column<string>(type: "text", nullable: false),
                    TableName = table.Column<string>(type: "text", nullable: false),
                    RecordId = table.Column<int>(type: "integer", nullable: true),
                    Timestamp = table.Column<DateTime>(type: "timestamp with time zone", nullable: false)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_ActionLogs", x => x.Id);
                    table.ForeignKey(
                        name: "FK_ActionLogs_Users_UserId",
                        column: x => x.UserId,
                        principalTable: "Users",
                        principalColumn: "Id");
                });

            migrationBuilder.CreateTable(
                name: "Bookings",
                columns: table => new
                {
                    Id = table.Column<int>(type: "integer", nullable: false)
                        .Annotation("Npgsql:ValueGenerationStrategy", NpgsqlValueGenerationStrategy.IdentityByDefaultColumn),
                    SpecialistId = table.Column<int>(type: "integer", nullable: false),
                    ClientId = table.Column<int>(type: "integer", nullable: false),
                    ServiceId = table.Column<int>(type: "integer", nullable: false),
                    Day = table.Column<DateTime>(type: "timestamp with time zone", nullable: false),
                    TimeInterval = table.Column<string>(type: "text", nullable: false)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_Bookings", x => x.Id);
                    table.ForeignKey(
                        name: "FK_Bookings_Services_ServiceId",
                        column: x => x.ServiceId,
                        principalTable: "Services",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Cascade);
                    table.ForeignKey(
                        name: "FK_Bookings_Users_ClientId",
                        column: x => x.ClientId,
                        principalTable: "Users",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Restrict);
                });

            migrationBuilder.CreateTable(
                name: "Chats",
                columns: table => new
                {
                    Id = table.Column<int>(type: "integer", nullable: false)
                        .Annotation("Npgsql:ValueGenerationStrategy", NpgsqlValueGenerationStrategy.IdentityByDefaultColumn),
                    SenderId = table.Column<int>(type: "integer", nullable: false),
                    ReceiverId = table.Column<int>(type: "integer", nullable: false),
                    LastMessage = table.Column<string>(type: "text", nullable: false),
                    Timestamp = table.Column<DateTime>(type: "timestamp with time zone", nullable: false)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_Chats", x => x.Id);
                    table.ForeignKey(
                        name: "FK_Chats_Users_ReceiverId",
                        column: x => x.ReceiverId,
                        principalTable: "Users",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Restrict);
                    table.ForeignKey(
                        name: "FK_Chats_Users_SenderId",
                        column: x => x.SenderId,
                        principalTable: "Users",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Restrict);
                });

            migrationBuilder.CreateTable(
                name: "Favorites",
                columns: table => new
                {
                    Id = table.Column<int>(type: "integer", nullable: false)
                        .Annotation("Npgsql:ValueGenerationStrategy", NpgsqlValueGenerationStrategy.IdentityByDefaultColumn),
                    ClientId = table.Column<int>(type: "integer", nullable: false),
                    ServiceId = table.Column<int>(type: "integer", nullable: false)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_Favorites", x => x.Id);
                    table.ForeignKey(
                        name: "FK_Favorites_Services_ServiceId",
                        column: x => x.ServiceId,
                        principalTable: "Services",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Cascade);
                    table.ForeignKey(
                        name: "FK_Favorites_Users_ClientId",
                        column: x => x.ClientId,
                        principalTable: "Users",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Cascade);
                });

            migrationBuilder.CreateTable(
                name: "Reviews",
                columns: table => new
                {
                    Id = table.Column<int>(type: "integer", nullable: false)
                        .Annotation("Npgsql:ValueGenerationStrategy", NpgsqlValueGenerationStrategy.IdentityByDefaultColumn),
                    SpecialistId = table.Column<int>(type: "integer", nullable: false),
                    ClientId = table.Column<int>(type: "integer", nullable: false),
                    Content = table.Column<string>(type: "text", nullable: false),
                    Rating = table.Column<int>(type: "integer", nullable: false),
                    CreatedAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: false),
                    ServiceModelId = table.Column<int>(type: "integer", nullable: true)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_Reviews", x => x.Id);
                    table.ForeignKey(
                        name: "FK_Reviews_Services_ServiceModelId",
                        column: x => x.ServiceModelId,
                        principalTable: "Services",
                        principalColumn: "Id");
                    table.ForeignKey(
                        name: "FK_Reviews_Users_ClientId",
                        column: x => x.ClientId,
                        principalTable: "Users",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Cascade);
                    table.ForeignKey(
                        name: "FK_Reviews_Users_SpecialistId",
                        column: x => x.SpecialistId,
                        principalTable: "Users",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Restrict);
                });

            migrationBuilder.CreateIndex(
                name: "IX_ActionLogs_UserId",
                table: "ActionLogs",
                column: "UserId");

            migrationBuilder.CreateIndex(
                name: "IX_Bookings_ClientId",
                table: "Bookings",
                column: "ClientId");

            migrationBuilder.CreateIndex(
                name: "IX_Bookings_ServiceId",
                table: "Bookings",
                column: "ServiceId");

            migrationBuilder.CreateIndex(
                name: "IX_Chats_ReceiverId",
                table: "Chats",
                column: "ReceiverId");

            migrationBuilder.CreateIndex(
                name: "IX_Chats_SenderId",
                table: "Chats",
                column: "SenderId");

            migrationBuilder.CreateIndex(
                name: "IX_Favorites_ClientId",
                table: "Favorites",
                column: "ClientId");

            migrationBuilder.CreateIndex(
                name: "IX_Favorites_ServiceId",
                table: "Favorites",
                column: "ServiceId");

            migrationBuilder.CreateIndex(
                name: "IX_Reviews_ClientId",
                table: "Reviews",
                column: "ClientId");

            migrationBuilder.CreateIndex(
                name: "IX_Reviews_ServiceModelId",
                table: "Reviews",
                column: "ServiceModelId");

            migrationBuilder.CreateIndex(
                name: "IX_Reviews_SpecialistId",
                table: "Reviews",
                column: "SpecialistId");
        }

        /// <inheritdoc />
        protected override void Down(MigrationBuilder migrationBuilder)
        {
            migrationBuilder.DropTable(
                name: "ActionLogs");

            migrationBuilder.DropTable(
                name: "Bookings");

            migrationBuilder.DropTable(
                name: "Chats");

            migrationBuilder.DropTable(
                name: "Favorites");

            migrationBuilder.DropTable(
                name: "Messages");

            migrationBuilder.DropTable(
                name: "ModeratorStatistics");

            migrationBuilder.DropTable(
                name: "Reviews");

            migrationBuilder.DropTable(
                name: "Schedules");

            migrationBuilder.DropTable(
                name: "Tickets");

            migrationBuilder.DropTable(
                name: "Services");

            migrationBuilder.DropTable(
                name: "Users");
        }
    }
}

================
File: Migrations/20241223221340_AddReviewsTable.Designer.cs
================
// <auto-generated />
using System;
using Microsoft.EntityFrameworkCore;
using Microsoft.EntityFrameworkCore.Infrastructure;
using Microsoft.EntityFrameworkCore.Migrations;
using Microsoft.EntityFrameworkCore.Storage.ValueConversion;
using Npgsql.EntityFrameworkCore.PostgreSQL.Metadata;
using TBLApi.Data;

#nullable disable

namespace TBLApi.Migrations
{
    [DbContext(typeof(AppDbContext))]
    [Migration("20241223221340_AddReviewsTable")]
    partial class AddReviewsTable
    {
        /// <inheritdoc />
        protected override void BuildTargetModel(ModelBuilder modelBuilder)
        {
#pragma warning disable 612, 618
            modelBuilder
                .HasAnnotation("ProductVersion", "7.0.0")
                .HasAnnotation("Relational:MaxIdentifierLength", 63);

            NpgsqlModelBuilderExtensions.UseIdentityByDefaultColumns(modelBuilder);

            modelBuilder.Entity("TBLApi.Models.ActionLog", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("integer");

                    NpgsqlPropertyBuilderExtensions.UseIdentityByDefaultColumn(b.Property<int>("Id"));

                    b.Property<string>("Action")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<int?>("RecordId")
                        .HasColumnType("integer");

                    b.Property<string>("TableName")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("Timestamp")
                        .HasColumnType("timestamp with time zone");

                    b.Property<int?>("UserId")
                        .HasColumnType("integer");

                    b.HasKey("Id");

                    b.HasIndex("UserId");

                    b.ToTable("ActionLogs");
                });

            modelBuilder.Entity("TBLApi.Models.Booking", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("integer");

                    NpgsqlPropertyBuilderExtensions.UseIdentityByDefaultColumn(b.Property<int>("Id"));

                    b.Property<int>("ClientId")
                        .HasColumnType("integer");

                    b.Property<DateTime>("Day")
                        .HasColumnType("timestamp with time zone");

                    b.Property<int>("ServiceId")
                        .HasColumnType("integer");

                    b.Property<int>("SpecialistId")
                        .HasColumnType("integer");

                    b.Property<string>("TimeInterval")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("ClientId");

                    b.HasIndex("ServiceId");

                    b.ToTable("Bookings");
                });

            modelBuilder.Entity("TBLApi.Models.Chat", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("integer");

                    NpgsqlPropertyBuilderExtensions.UseIdentityByDefaultColumn(b.Property<int>("Id"));

                    b.Property<string>("LastMessage")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<int>("ReceiverId")
                        .HasColumnType("integer");

                    b.Property<int>("SenderId")
                        .HasColumnType("integer");

                    b.Property<DateTime>("Timestamp")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.HasIndex("ReceiverId");

                    b.HasIndex("SenderId");

                    b.ToTable("Chats");
                });

            modelBuilder.Entity("TBLApi.Models.Favorite", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("integer");

                    NpgsqlPropertyBuilderExtensions.UseIdentityByDefaultColumn(b.Property<int>("Id"));

                    b.Property<int>("ClientId")
                        .HasColumnType("integer");

                    b.Property<int>("ServiceId")
                        .HasColumnType("integer");

                    b.HasKey("Id");

                    b.HasIndex("ClientId");

                    b.HasIndex("ServiceId");

                    b.ToTable("Favorites");
                });

            modelBuilder.Entity("TBLApi.Models.Message", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("integer");

                    NpgsqlPropertyBuilderExtensions.UseIdentityByDefaultColumn(b.Property<int>("Id"));

                    b.Property<int>("ChatId")
                        .HasColumnType("integer");

                    b.Property<string>("Content")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<int>("ReceiverId")
                        .HasColumnType("integer");

                    b.Property<int>("SenderId")
                        .HasColumnType("integer");

                    b.Property<DateTime>("Timestamp")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.ToTable("Messages");
                });

            modelBuilder.Entity("TBLApi.Models.ModeratorStatistic", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("integer");

                    NpgsqlPropertyBuilderExtensions.UseIdentityByDefaultColumn(b.Property<int>("Id"));

                    b.Property<int>("BlockedProfiles")
                        .HasColumnType("integer");

                    b.Property<int>("ClosedTickets")
                        .HasColumnType("integer");

                    b.Property<int>("ModeratorId")
                        .HasColumnType("integer");

                    b.Property<int>("RejectedTickets")
                        .HasColumnType("integer");

                    b.Property<int>("RestrictedProfiles")
                        .HasColumnType("integer");

                    b.HasKey("Id");

                    b.ToTable("ModeratorStatistics");
                });

            modelBuilder.Entity("TBLApi.Models.Review", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("integer");

                    NpgsqlPropertyBuilderExtensions.UseIdentityByDefaultColumn(b.Property<int>("Id"));

                    b.Property<int>("ClientId")
                        .HasColumnType("integer");

                    b.Property<string>("Content")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<int>("Rating")
                        .HasColumnType("integer");

                    b.Property<int?>("ServiceModelId")
                        .HasColumnType("integer");

                    b.Property<int>("SpecialistId")
                        .HasColumnType("integer");

                    b.HasKey("Id");

                    b.HasIndex("ClientId");

                    b.HasIndex("ServiceModelId");

                    b.HasIndex("SpecialistId");

                    b.ToTable("Reviews");
                });

            modelBuilder.Entity("TBLApi.Models.Schedule", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("integer");

                    NpgsqlPropertyBuilderExtensions.UseIdentityByDefaultColumn(b.Property<int>("Id"));

                    b.Property<string>("BookedIntervals")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("Day")
                        .HasColumnType("timestamp with time zone");

                    b.Property<int>("SpecialistId")
                        .HasColumnType("integer");

                    b.Property<string>("WorkingHours")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Schedules");
                });

            modelBuilder.Entity("TBLApi.Models.ServiceModel", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("integer");

                    NpgsqlPropertyBuilderExtensions.UseIdentityByDefaultColumn(b.Property<int>("Id"));

                    b.Property<string>("City")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Description")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<decimal>("Price")
                        .HasColumnType("numeric");

                    b.Property<int>("SpecialistId")
                        .HasColumnType("integer");

                    b.Property<string>("SpecialistName")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Title")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Services");
                });

            modelBuilder.Entity("TBLApi.Models.Ticket", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("integer");

                    NpgsqlPropertyBuilderExtensions.UseIdentityByDefaultColumn(b.Property<int>("Id"));

                    b.Property<string>("ActionTaken")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Comment")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<int>("ModeratorId")
                        .HasColumnType("integer");

                    b.Property<string>("Status")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<int>("TargetId")
                        .HasColumnType("integer");

                    b.Property<int>("UserId")
                        .HasColumnType("integer");

                    b.HasKey("Id");

                    b.ToTable("Tickets");
                });

            modelBuilder.Entity("TBLApi.Models.User", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("integer");

                    NpgsqlPropertyBuilderExtensions.UseIdentityByDefaultColumn(b.Property<int>("Id"));

                    b.Property<string>("City")
                        .HasColumnType("text");

                    b.Property<string>("Description")
                        .HasColumnType("text");

                    b.Property<string>("Email")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("EmailConfirmationToken")
                        .HasColumnType("text");

                    b.Property<bool>("IsEmailConfirmed")
                        .HasColumnType("boolean");

                    b.Property<string>("LinkToProfile")
                        .HasColumnType("text");

                    b.Property<string>("Name")
                        .HasColumnType("text");

                    b.Property<string>("Password")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("PasswordResetExpiration")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("PasswordResetToken")
                        .HasColumnType("text");

                    b.Property<string>("PhotoBase64")
                        .HasColumnType("text");

                    b.Property<string>("Role")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Username")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Users");
                });

            modelBuilder.Entity("TBLApi.Models.ActionLog", b =>
                {
                    b.HasOne("TBLApi.Models.User", "User")
                        .WithMany()
                        .HasForeignKey("UserId");

                    b.Navigation("User");
                });

            modelBuilder.Entity("TBLApi.Models.Booking", b =>
                {
                    b.HasOne("TBLApi.Models.User", "Client")
                        .WithMany()
                        .HasForeignKey("ClientId")
                        .OnDelete(DeleteBehavior.Restrict)
                        .IsRequired();

                    b.HasOne("TBLApi.Models.ServiceModel", "Service")
                        .WithMany("Bookings")
                        .HasForeignKey("ServiceId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Client");

                    b.Navigation("Service");
                });

            modelBuilder.Entity("TBLApi.Models.Chat", b =>
                {
                    b.HasOne("TBLApi.Models.User", "Receiver")
                        .WithMany()
                        .HasForeignKey("ReceiverId")
                        .OnDelete(DeleteBehavior.Restrict)
                        .IsRequired();

                    b.HasOne("TBLApi.Models.User", "Sender")
                        .WithMany()
                        .HasForeignKey("SenderId")
                        .OnDelete(DeleteBehavior.Restrict)
                        .IsRequired();

                    b.Navigation("Receiver");

                    b.Navigation("Sender");
                });

            modelBuilder.Entity("TBLApi.Models.Favorite", b =>
                {
                    b.HasOne("TBLApi.Models.User", "Client")
                        .WithMany("Favorites")
                        .HasForeignKey("ClientId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("TBLApi.Models.ServiceModel", "Service")
                        .WithMany("Favorites")
                        .HasForeignKey("ServiceId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Client");

                    b.Navigation("Service");
                });

            modelBuilder.Entity("TBLApi.Models.Review", b =>
                {
                    b.HasOne("TBLApi.Models.User", "Client")
                        .WithMany("Reviews")
                        .HasForeignKey("ClientId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("TBLApi.Models.ServiceModel", null)
                        .WithMany("Reviews")
                        .HasForeignKey("ServiceModelId");

                    b.HasOne("TBLApi.Models.User", "Specialist")
                        .WithMany()
                        .HasForeignKey("SpecialistId")
                        .OnDelete(DeleteBehavior.Restrict)
                        .IsRequired();

                    b.Navigation("Client");

                    b.Navigation("Specialist");
                });

            modelBuilder.Entity("TBLApi.Models.ServiceModel", b =>
                {
                    b.Navigation("Bookings");

                    b.Navigation("Favorites");

                    b.Navigation("Reviews");
                });

            modelBuilder.Entity("TBLApi.Models.User", b =>
                {
                    b.Navigation("Favorites");

                    b.Navigation("Reviews");
                });
#pragma warning restore 612, 618
        }
    }
}

================
File: Migrations/AppDbContextModelSnapshot.cs
================
// <auto-generated />
using System;
using Microsoft.EntityFrameworkCore;
using Microsoft.EntityFrameworkCore.Infrastructure;
using Microsoft.EntityFrameworkCore.Storage.ValueConversion;
using Npgsql.EntityFrameworkCore.PostgreSQL.Metadata;
using TBLApi.Data;

#nullable disable

namespace TBLApi.Migrations
{
    [DbContext(typeof(AppDbContext))]
    partial class AppDbContextModelSnapshot : ModelSnapshot
    {
        protected override void BuildModel(ModelBuilder modelBuilder)
        {
#pragma warning disable 612, 618
            modelBuilder
                .HasAnnotation("ProductVersion", "7.0.0")
                .HasAnnotation("Relational:MaxIdentifierLength", 63);

            NpgsqlModelBuilderExtensions.UseIdentityByDefaultColumns(modelBuilder);

            modelBuilder.Entity("TBLApi.Models.ActionLog", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("integer");

                    NpgsqlPropertyBuilderExtensions.UseIdentityByDefaultColumn(b.Property<int>("Id"));

                    b.Property<string>("Action")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<int?>("RecordId")
                        .HasColumnType("integer");

                    b.Property<string>("TableName")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("Timestamp")
                        .HasColumnType("timestamp with time zone");

                    b.Property<int?>("UserId")
                        .HasColumnType("integer");

                    b.HasKey("Id");

                    b.HasIndex("UserId");

                    b.ToTable("ActionLogs");
                });

            modelBuilder.Entity("TBLApi.Models.Booking", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("integer");

                    NpgsqlPropertyBuilderExtensions.UseIdentityByDefaultColumn(b.Property<int>("Id"));

                    b.Property<int>("ClientId")
                        .HasColumnType("integer");

                    b.Property<DateTime>("Day")
                        .HasColumnType("timestamp with time zone");

                    b.Property<int>("ServiceId")
                        .HasColumnType("integer");

                    b.Property<int>("SpecialistId")
                        .HasColumnType("integer");

                    b.Property<string>("TimeInterval")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("ClientId");

                    b.HasIndex("ServiceId");

                    b.ToTable("Bookings");
                });

            modelBuilder.Entity("TBLApi.Models.Chat", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("integer");

                    NpgsqlPropertyBuilderExtensions.UseIdentityByDefaultColumn(b.Property<int>("Id"));

                    b.Property<string>("LastMessage")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<int>("ReceiverId")
                        .HasColumnType("integer");

                    b.Property<int>("SenderId")
                        .HasColumnType("integer");

                    b.Property<DateTime>("Timestamp")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.HasIndex("ReceiverId");

                    b.HasIndex("SenderId");

                    b.ToTable("Chats");
                });

            modelBuilder.Entity("TBLApi.Models.Favorite", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("integer");

                    NpgsqlPropertyBuilderExtensions.UseIdentityByDefaultColumn(b.Property<int>("Id"));

                    b.Property<int>("ClientId")
                        .HasColumnType("integer");

                    b.Property<int>("ServiceId")
                        .HasColumnType("integer");

                    b.HasKey("Id");

                    b.HasIndex("ClientId");

                    b.HasIndex("ServiceId");

                    b.ToTable("Favorites");
                });

            modelBuilder.Entity("TBLApi.Models.Message", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("integer");

                    NpgsqlPropertyBuilderExtensions.UseIdentityByDefaultColumn(b.Property<int>("Id"));

                    b.Property<int>("ChatId")
                        .HasColumnType("integer");

                    b.Property<string>("Content")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<int>("ReceiverId")
                        .HasColumnType("integer");

                    b.Property<int>("SenderId")
                        .HasColumnType("integer");

                    b.Property<DateTime>("Timestamp")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.ToTable("Messages");
                });

            modelBuilder.Entity("TBLApi.Models.ModeratorStatistic", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("integer");

                    NpgsqlPropertyBuilderExtensions.UseIdentityByDefaultColumn(b.Property<int>("Id"));

                    b.Property<int>("BlockedProfiles")
                        .HasColumnType("integer");

                    b.Property<int>("ClosedTickets")
                        .HasColumnType("integer");

                    b.Property<int>("ModeratorId")
                        .HasColumnType("integer");

                    b.Property<int>("RejectedTickets")
                        .HasColumnType("integer");

                    b.Property<int>("RestrictedProfiles")
                        .HasColumnType("integer");

                    b.HasKey("Id");

                    b.ToTable("ModeratorStatistics");
                });

            modelBuilder.Entity("TBLApi.Models.Review", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("integer");

                    NpgsqlPropertyBuilderExtensions.UseIdentityByDefaultColumn(b.Property<int>("Id"));

                    b.Property<int>("ClientId")
                        .HasColumnType("integer");

                    b.Property<string>("Content")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<int>("Rating")
                        .HasColumnType("integer");

                    b.Property<int?>("ServiceModelId")
                        .HasColumnType("integer");

                    b.Property<int>("SpecialistId")
                        .HasColumnType("integer");

                    b.HasKey("Id");

                    b.HasIndex("ClientId");

                    b.HasIndex("ServiceModelId");

                    b.HasIndex("SpecialistId");

                    b.ToTable("Reviews");
                });

            modelBuilder.Entity("TBLApi.Models.Schedule", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("integer");

                    NpgsqlPropertyBuilderExtensions.UseIdentityByDefaultColumn(b.Property<int>("Id"));

                    b.Property<string>("BookedIntervals")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("Day")
                        .HasColumnType("timestamp with time zone");

                    b.Property<int>("SpecialistId")
                        .HasColumnType("integer");

                    b.Property<string>("WorkingHours")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Schedules");
                });

            modelBuilder.Entity("TBLApi.Models.ServiceModel", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("integer");

                    NpgsqlPropertyBuilderExtensions.UseIdentityByDefaultColumn(b.Property<int>("Id"));

                    b.Property<string>("City")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Description")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<decimal>("Price")
                        .HasColumnType("numeric");

                    b.Property<int>("SpecialistId")
                        .HasColumnType("integer");

                    b.Property<string>("SpecialistName")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Title")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Services");
                });

            modelBuilder.Entity("TBLApi.Models.Ticket", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("integer");

                    NpgsqlPropertyBuilderExtensions.UseIdentityByDefaultColumn(b.Property<int>("Id"));

                    b.Property<string>("ActionTaken")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Comment")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<int>("ModeratorId")
                        .HasColumnType("integer");

                    b.Property<string>("Status")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<int>("TargetId")
                        .HasColumnType("integer");

                    b.Property<int>("UserId")
                        .HasColumnType("integer");

                    b.HasKey("Id");

                    b.ToTable("Tickets");
                });

            modelBuilder.Entity("TBLApi.Models.User", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("integer");

                    NpgsqlPropertyBuilderExtensions.UseIdentityByDefaultColumn(b.Property<int>("Id"));

                    b.Property<string>("City")
                        .HasColumnType("text");

                    b.Property<string>("Description")
                        .HasColumnType("text");

                    b.Property<string>("Email")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("EmailConfirmationToken")
                        .HasColumnType("text");

                    b.Property<bool>("IsEmailConfirmed")
                        .HasColumnType("boolean");

                    b.Property<string>("LinkToProfile")
                        .HasColumnType("text");

                    b.Property<string>("Name")
                        .HasColumnType("text");

                    b.Property<string>("Password")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("PasswordResetExpiration")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("PasswordResetToken")
                        .HasColumnType("text");

                    b.Property<string>("PhotoBase64")
                        .HasColumnType("text");

                    b.Property<string>("Role")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Username")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Users");
                });

            modelBuilder.Entity("TBLApi.Models.ActionLog", b =>
                {
                    b.HasOne("TBLApi.Models.User", "User")
                        .WithMany()
                        .HasForeignKey("UserId");

                    b.Navigation("User");
                });

            modelBuilder.Entity("TBLApi.Models.Booking", b =>
                {
                    b.HasOne("TBLApi.Models.User", "Client")
                        .WithMany()
                        .HasForeignKey("ClientId")
                        .OnDelete(DeleteBehavior.Restrict)
                        .IsRequired();

                    b.HasOne("TBLApi.Models.ServiceModel", "Service")
                        .WithMany("Bookings")
                        .HasForeignKey("ServiceId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Client");

                    b.Navigation("Service");
                });

            modelBuilder.Entity("TBLApi.Models.Chat", b =>
                {
                    b.HasOne("TBLApi.Models.User", "Receiver")
                        .WithMany()
                        .HasForeignKey("ReceiverId")
                        .OnDelete(DeleteBehavior.Restrict)
                        .IsRequired();

                    b.HasOne("TBLApi.Models.User", "Sender")
                        .WithMany()
                        .HasForeignKey("SenderId")
                        .OnDelete(DeleteBehavior.Restrict)
                        .IsRequired();

                    b.Navigation("Receiver");

                    b.Navigation("Sender");
                });

            modelBuilder.Entity("TBLApi.Models.Favorite", b =>
                {
                    b.HasOne("TBLApi.Models.User", "Client")
                        .WithMany("Favorites")
                        .HasForeignKey("ClientId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("TBLApi.Models.ServiceModel", "Service")
                        .WithMany("Favorites")
                        .HasForeignKey("ServiceId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Client");

                    b.Navigation("Service");
                });

            modelBuilder.Entity("TBLApi.Models.Review", b =>
                {
                    b.HasOne("TBLApi.Models.User", "Client")
                        .WithMany("Reviews")
                        .HasForeignKey("ClientId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("TBLApi.Models.ServiceModel", null)
                        .WithMany("Reviews")
                        .HasForeignKey("ServiceModelId");

                    b.HasOne("TBLApi.Models.User", "Specialist")
                        .WithMany()
                        .HasForeignKey("SpecialistId")
                        .OnDelete(DeleteBehavior.Restrict)
                        .IsRequired();

                    b.Navigation("Client");

                    b.Navigation("Specialist");
                });

            modelBuilder.Entity("TBLApi.Models.ServiceModel", b =>
                {
                    b.Navigation("Bookings");

                    b.Navigation("Favorites");

                    b.Navigation("Reviews");
                });

            modelBuilder.Entity("TBLApi.Models.User", b =>
                {
                    b.Navigation("Favorites");

                    b.Navigation("Reviews");
                });
#pragma warning restore 612, 618
        }
    }
}

================
File: Models/ActionLog.cs
================
namespace TBLApi.Models
{
    public class ActionLog
    {
        public int Id { get; set; }
        public int? UserId { get; set; }
        public string Action { get; set; }
        public string TableName { get; set; }
        public int? RecordId { get; set; }
        public DateTime Timestamp { get; set; }

        public User User { get; set; }
    }
}

================
File: Models/Booking.cs
================
using System.ComponentModel.DataAnnotations.Schema;
using System.ComponentModel.DataAnnotations;
using TBLApi.Models;

public class Booking
{
    [Key]
    public int Id { get; set; }

    [Required]
    public int SpecialistId { get; set; }

    [ForeignKey("SpecialistId")]
    public virtual User Specialist { get; set; }

    [Required]
    public int ClientId { get; set; }

    [ForeignKey("ClientId")]
    public virtual User Client { get; set; }

    [Required]
    public int ServiceId { get; set; }

    [ForeignKey("ServiceId")]
    public virtual ServiceModel Service { get; set; }

    [Required]
    public DateOnly Day { get; set; }

    public string TimeInterval { get; set; } // Удалено [NotMapped]

    [NotMapped] // Только для внутреннего использования
    public TimeSpan StartTime
    {
        get => TimeSpan.Parse(TimeInterval.Split('-')[0]);
        set
        {
            var parts = TimeInterval?.Split('-');
            TimeInterval = $"{value}-{parts?[1]}";
        }
    }

    [NotMapped] // Только для внутреннего использования
    public TimeSpan EndTime
    {
        get => TimeSpan.Parse(TimeInterval.Split('-')[1]);
        set
        {
            var parts = TimeInterval?.Split('-');
            TimeInterval = $"{parts?[0]}-{value}";
        }
    }
}

================
File: Models/Chat.cs
================
using System.ComponentModel.DataAnnotations.Schema;

namespace TBLApi.Models
{
    public class Chat
    {
        public int Id { get; set; } // Идентификатор чата
        public int SenderId { get; set; } // Отправитель чата
        public int ReceiverId { get; set; } // Получатель чата
        public string LastMessage { get; set; } // Последнее сообщение
        public DateTime Timestamp { get; set; } // Время последнего сообщения

        [ForeignKey(nameof(SenderId))]
        public User Sender { get; set; }

        [ForeignKey(nameof(ReceiverId))]
        public User Receiver { get; set; }
    }
}

================
File: Models/Favorite.cs
================
using System.ComponentModel.DataAnnotations;
using System.ComponentModel.DataAnnotations.Schema;
using System.Text.Json.Serialization;

namespace TBLApi.Models
{
    public class Favorite
    {
        [Key]
        [DatabaseGenerated(DatabaseGeneratedOption.Identity)]
        public int Id { get; set; }

        [Required] // Поле ClientId обязательно
        public int ClientId { get; set; }

        [Required] // Поле ServiceId обязательно
        public int ServiceId { get; set; }

        // Навигационные свойства. НЕ делайте их [Required], если вы отправляете только идентификаторы.
        [ForeignKey(nameof(ClientId))]
        public User Client { get; set; }

        [ForeignKey(nameof(ServiceId))]
        public ServiceModel Service { get; set; }
    }

}

================
File: Models/LocationUpdateRequest.cs
================
namespace TBLApi.Models
{
    public class LocationUpdateRequest
    {
        public double Latitude { get; set; }
        public double Longitude { get; set; }
        public string Address { get; set; }
    }
}

================
File: Models/ModeratorStats.cs
================
namespace TBLApi.Models
{
    public class ModeratorStatistic
    {
        public int Id { get; set; }
        public int ModeratorId { get; set; } // ID модератора (UserId)
        public int ClosedTickets { get; set; } = 0; // Количество закрытых тикетов
        public int BlockedProfiles { get; set; } = 0; // Количество заблокированных профилей
        public int RestrictedProfiles { get; set; } = 0; // Количество профилей с ограничением
        public int RejectedTickets { get; set; } = 0; // Количество отклонённых тикетов
    }

}

================
File: Models/Order.cs
================
using System;
using TBLApi.Models;
namespace TBPApi
{
    public class Order
    {
        public int Id { get; set; } // Первичный ключ
        public DateTime Date { get; set; }
        public string Time { get; set; }
        public string ServiceType { get; set; }
        public string Title { get; set; }
        public string Description { get; set; }
        public string ClientName { get; set; }  // Имя клиента
        public string ClientPhoto { get; set; }
    }
}

================
File: Models/Review.cs
================
using System.ComponentModel.DataAnnotations;
using System.ComponentModel.DataAnnotations.Schema;

namespace TBLApi.Models
{
    public class Review
    {
        public int Id { get; set; }
        public int SpecialistId { get; set; }
        public int ClientId { get; set; }
        public string Content { get; set; }
        [Range(1, 5)]
        public int Rating { get; set; }

        public DateTime CreatedAt { get; set; }

        public virtual User Specialist { get; set; }
        public virtual User Client { get; set; }

    }
}

================
File: Models/Schedule.cs
================
using System.ComponentModel.DataAnnotations.Schema;
using System.Text.Json;

namespace TBLApi.Models
{
    public class Schedule
    {
        public int Id { get; set; }
        public int SpecialistId { get; set; }
        public DateOnly Day { get; set; } // Убедитесь, что клиент передаёт дату в ISO 8601 формате
        public TimeSpan StartTime { get; set; }
        public TimeSpan EndTime { get; set; }
        public int BreakDuration { get; set; }
        [NotMapped]
        public string? BookedIntervals { get; set; } // JSON-строка
        [NotMapped]
        public string WorkingHours { get; set; } = "[]";

        [NotMapped]
        public List<(TimeSpan Start, TimeSpan End)> WorkingHoursList
        {
            get
            {
                if (string.IsNullOrEmpty(WorkingHours))
                    return new List<(TimeSpan, TimeSpan)>();

                try
                {
                    // Десериализация строкового списка интервалов
                    var intervals = JsonSerializer.Deserialize<List<string>>(WorkingHours, new JsonSerializerOptions
                    {
                        PropertyNameCaseInsensitive = true
                    });

                    return intervals.Select(ParseTimeInterval).ToList();
                }
                catch (JsonException ex)
                {
                    Console.WriteLine($"Ошибка десериализации WorkingHours: {ex.Message}");
                    return new List<(TimeSpan, TimeSpan)>();
                }
            }
            set
            {
                // Сериализация интервалов обратно в строку
                WorkingHours = JsonSerializer.Serialize(value.Select(i => $"{i.Start:hh\\:mm} - {i.End:hh\\:mm}"));
            }
        }

        [NotMapped]
        public List<(TimeSpan Start, TimeSpan End)> BookedIntervalsList
        {
            get => string.IsNullOrEmpty(BookedIntervals)
                ? new List<(TimeSpan, TimeSpan)>()
                : JsonSerializer.Deserialize<List<(TimeSpan Start, TimeSpan End)>>(BookedIntervals);
            set => BookedIntervals = JsonSerializer.Serialize(value);
        }


        [NotMapped]
        public List<(TimeSpan Start, TimeSpan End)> AvailableIntervals
        {
            get
            {
                var available = new List<(TimeSpan Start, TimeSpan End)>();
                var currentTime = StartTime;

                while (currentTime + TimeSpan.FromMinutes(BreakDuration) < EndTime)
                {
                    var nextTime = currentTime + TimeSpan.FromMinutes(BreakDuration);

                    // Проверка на пересечение с BookedIntervals
                    if (!BookedIntervalsList.Any(b =>
                            b.Start < nextTime && b.End > currentTime))
                    {
                        available.Add((currentTime, nextTime));
                    }

                    currentTime = nextTime;
                }

                return available;
            }
        }
        private static (TimeSpan Start, TimeSpan End) ParseTimeInterval(string timeInterval)
        {
            var parts = timeInterval.Split('-');
            if (parts.Length == 2 &&
                TimeSpan.TryParse(parts[0].Trim(), out var start) &&
                TimeSpan.TryParse(parts[1].Trim(), out var end))
            {
                return (start, end);
            }

            throw new FormatException("Неверный формат интервала времени. Ожидается 'HH:mm - HH:mm'.");
        }
    }
}

================
File: Models/Service.cs
================
using System.ComponentModel.DataAnnotations;

namespace TBLApi.Models
{
    public class ServiceModel
    {
        public int Id { get; set; }
        public required string Title { get; set; } // Исправлено
        public required string Description { get; set; }
        public decimal Price { get; set; }
        public int SpecialistId { get; set; }
        public string City { get; set; }
        public string SpecialistName { get; set; }
        public int Duration { get; set; }


        [Required]
        public List<Review> Reviews { get; set; } = new List<Review>();

        [Required]
        public List<Favorite> Favorites { get; set; } = new List<Favorite>();

        public ICollection<Booking> Bookings { get; set; } = new List<Booking>();
    }
}

================
File: Models/UpdateProfileModel.cs
================
namespace TBLApi.Models
{
    public class UpdateProfileModel
    {
        public string? Username { get; set; }
        public string? Password { get; set; }
        public string? Email { get; set; }
        public string? Role { get; set; }
        public string? Name { get; set; }
        public string? City { get; set; }
        public string? Description { get; set; }
    }

}

================
File: Models/User.cs
================
using System.ComponentModel.DataAnnotations;
using System.ComponentModel.DataAnnotations.Schema;
namespace TBLApi.Models
{
    public class User
    {
        public int Id { get; set; }
        public string Username { get; set; }
        public string Password { get; set; }
        public string Email { get; set; }
        public string? PhotoBase64 { get; set; } = "data:image/png;base64,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";

        public string? LinkToProfile { get; set; }
        public string? Name { get; set; } = "Имя";
        public string? City { get; set; } = "Город";
        public string Role { get; set; }
        public string? Description { get; set; } = "Описание";
        public bool IsEmailConfirmed { get; set; }
        public string? EmailConfirmationToken { get; set; }
        public string? PasswordResetToken { get; set; }
        public DateTime? PasswordResetExpiration { get; set; }
        public double Latitude { get; set; }
        public double Longitude { get; set; }
        public string Address { get; set; }


        [Required] // Указывает, что поле обязательно
        public List<Review> Reviews { get; set; } = new List<Review>(); // Инициализировано пустым списком

        [Required]
        public List<Favorite> Favorites { get; set; } = new List<Favorite>();
    }
}

================
File: obj/Debug/net7.0/.NETCoreApp,Version=v7.0.AssemblyAttributes.cs
================
// <autogenerated />
using System;
using System.Reflection;
[assembly: global::System.Runtime.Versioning.TargetFrameworkAttribute(".NETCoreApp,Version=v7.0", FrameworkDisplayName = ".NET 7.0")]

================
File: obj/Debug/net7.0/TBLApi.AssemblyInfo.cs
================
//------------------------------------------------------------------------------
// <auto-generated>
//     Этот код создан программой.
//     Исполняемая версия:4.0.30319.42000
//
//     Изменения в этом файле могут привести к неправильной работе и будут потеряны в случае
//     повторной генерации кода.
// </auto-generated>
//------------------------------------------------------------------------------

using System;
using System.Reflection;

[assembly: System.Reflection.AssemblyCompanyAttribute("TBLApi")]
[assembly: System.Reflection.AssemblyConfigurationAttribute("Debug")]
[assembly: System.Reflection.AssemblyFileVersionAttribute("1.0.0.0")]
[assembly: System.Reflection.AssemblyInformationalVersionAttribute("1.0.0+7419d157cf152bd54a8c47b36952f2d801d4c6ef")]
[assembly: System.Reflection.AssemblyProductAttribute("TBLApi")]
[assembly: System.Reflection.AssemblyTitleAttribute("TBLApi")]
[assembly: System.Reflection.AssemblyVersionAttribute("1.0.0.0")]

// Создано классом WriteCodeFragment MSBuild.

================
File: obj/Debug/net7.0/TBLApi.AssemblyInfoInputs.cache
================
225cc6fbbadc394c23af884d8dd0e918ac54084cbb06c6910ccf7b0c360cc8d1

================
File: obj/Debug/net7.0/TBLApi.GeneratedMSBuildEditorConfig.editorconfig
================
is_global = true
build_property.TargetFramework = net7.0
build_property.TargetPlatformMinVersion = 
build_property.UsingMicrosoftNETSdkWeb = true
build_property.ProjectTypeGuids = 
build_property.InvariantGlobalization = 
build_property.PlatformNeutralAssembly = 
build_property.EnforceExtendedAnalyzerRules = 
build_property._SupportedPlatformList = Linux,macOS,Windows
build_property.RootNamespace = TBLApi
build_property.RootNamespace = TBLApi
build_property.ProjectDir = C:\PRODJ\TBLApi\
build_property.EnableComHosting = 
build_property.EnableGeneratedComInterfaceComImportInterop = 
build_property.RazorLangVersion = 7.0
build_property.SupportLocalizedComponentNames = 
build_property.GenerateRazorMetadataSourceChecksumAttributes = 
build_property.MSBuildProjectDirectory = C:\PRODJ\TBLApi
build_property._RazorSourceGeneratorDebug = 
build_property.EffectiveAnalysisLevelStyle = 7.0
build_property.EnableCodeStyleSeverity =

================
File: obj/Debug/net7.0/TBLApi.GlobalUsings.g.cs
================
// <auto-generated/>
global using global::Microsoft.AspNetCore.Builder;
global using global::Microsoft.AspNetCore.Hosting;
global using global::Microsoft.AspNetCore.Http;
global using global::Microsoft.AspNetCore.Routing;
global using global::Microsoft.Extensions.Configuration;
global using global::Microsoft.Extensions.DependencyInjection;
global using global::Microsoft.Extensions.Hosting;
global using global::Microsoft.Extensions.Logging;
global using global::System;
global using global::System.Collections.Generic;
global using global::System.IO;
global using global::System.Linq;
global using global::System.Net.Http;
global using global::System.Net.Http.Json;
global using global::System.Threading;
global using global::System.Threading.Tasks;

================
File: Program.cs
================
using Microsoft.EntityFrameworkCore;
using TBLApi.Data;
using TBLApi.Services;


var builder = WebApplication.CreateBuilder(args);

// Добавляем поддержку контроллеров
builder.Services.AddControllers();
builder.Services.AddControllers();
builder.Services.AddLogging();

// Настройка Swagger
builder.Services.AddEndpointsApiExplorer();
builder.Services.AddSwaggerGen();

builder.Services.AddControllers()
    .AddJsonOptions(options =>
    {
        options.JsonSerializerOptions.ReferenceHandler = System.Text.Json.Serialization.ReferenceHandler.IgnoreCycles;
        options.JsonSerializerOptions.DefaultIgnoreCondition = System.Text.Json.Serialization.JsonIgnoreCondition.WhenWritingNull;
    });


// Чтение параметров SMTP из конфигурации
var smtpSettings = builder.Configuration.GetSection("SmtpSettings");
builder.Services.AddSingleton<IEmailSender>(provider =>
    new SmtpEmailService(
        smtpSettings["Server"],
        int.Parse(smtpSettings["Port"]),
        smtpSettings["User"],
        smtpSettings["Password"]
    ));

// Подключение к базе данных
builder.Services.AddDbContext<AppDbContext>(options =>
    options.UseNpgsql(builder.Configuration.GetConnectionString("DefaultConnection")));

// Настройка CORS
builder.Services.AddCors(options =>
{
    options.AddPolicy("AllowAll", policy =>
    {
        policy.AllowAnyOrigin()
              .AllowAnyMethod()
              .AllowAnyHeader();
    });
});

var app = builder.Build();

if (app.Environment.IsDevelopment())
{
    app.UseSwagger();
    app.UseSwaggerUI();
    app.Use(async (context, next) =>
    {
        try
        {
            await next();
        }
        catch (Exception ex)
        {
            Console.WriteLine($"[ERROR]: {ex.Message}");
            throw;
        }
    });

}

app.UseHttpsRedirection();
app.UseCors("AllowAll");
app.UseAuthorization();
app.MapControllers();
app.Run();

================
File: Properties/launchSettings.json
================
{
  "$schema": "https://json.schemastore.org/launchsettings.json",
  "iisSettings": {
    "windowsAuthentication": false,
    "anonymousAuthentication": true,
    "iisExpress": {
      "applicationUrl": "http://localhost:61646",
      "sslPort": 44306
    }
  },
  "profiles": {
    "http": {
      "commandName": "Project",
      "dotnetRunMessages": true,
      "launchBrowser": true,
      "launchUrl": "swagger",
      "applicationUrl": "http://localhost:5258",
      "environmentVariables": {
        "ASPNETCORE_ENVIRONMENT": "Development"
      }
    },
    "https": {
      "commandName": "Project",
      "dotnetRunMessages": true,
      "launchBrowser": true,
      "launchUrl": "swagger",
      "applicationUrl": "https://localhost:7014;http://localhost:5258",
      "environmentVariables": {
        "ASPNETCORE_ENVIRONMENT": "Development"
      }
    },
    "IIS Express": {
      "commandName": "IISExpress",
      "launchBrowser": true,
      "launchUrl": "swagger",
      "environmentVariables": {
        "ASPNETCORE_ENVIRONMENT": "Development"
      }
    }
  }
}

================
File: Services/IEmailSender.cs
================
namespace TBLApi.Services
{
    public interface IEmailSender
    {
        Task SendEmailAsync(string email, string subject, string message);
    }
}

================
File: Services/SmtpEmailService.cs
================
using MailKit.Net.Smtp;
using MimeKit;

namespace TBLApi.Services
{
    public class SmtpEmailService : IEmailSender
    {
        private readonly string _smtpServer;
        private readonly int _smtpPort;
        private readonly string _smtpUser;
        private readonly string _smtpPass;

        public SmtpEmailService(string smtpServer, int smtpPort, string smtpUser, string smtpPass)
        {
            _smtpServer = smtpServer;
            _smtpPort = smtpPort;
            _smtpUser = smtpUser;
            _smtpPass = smtpPass;
        }

        public async Task SendEmailAsync(string toEmail, string subject, string body)
        {
            var email = new MimeMessage();
            email.From.Add(new MailboxAddress("TBL App", _smtpUser));
            email.To.Add(new MailboxAddress("", toEmail));
            email.Subject = subject;

            email.Body = new TextPart("html")
            {
                Text = body
            };

            using var smtp = new SmtpClient();
            try
            {
                await smtp.ConnectAsync(_smtpServer, _smtpPort, MailKit.Security.SecureSocketOptions.StartTls);
                await smtp.AuthenticateAsync(_smtpUser, _smtpPass);
                await smtp.SendAsync(email);
                await smtp.DisconnectAsync(true);
            }
            catch (Exception ex)
            {
                throw new Exception($"Ошибка отправки email: {ex.Message}");
            }
        }
    }
}

================
File: TBLApi.csproj
================
<Project Sdk="Microsoft.NET.Sdk.Web">

  <PropertyGroup>
    <TargetFramework>net7.0</TargetFramework>
    <Nullable>enable</Nullable>
    <ImplicitUsings>enable</ImplicitUsings>
  </PropertyGroup>

  <ItemGroup>
    <PackageReference Include="BCrypt.Net-Next" Version="4.0.3" />
    <PackageReference Include="MailKit" Version="4.9.0" />
    <PackageReference Include="Microsoft.AspNetCore.Diagnostics.EntityFrameworkCore" Version="7.0.0" />
    <PackageReference Include="Microsoft.AspNetCore.OpenApi" Version="7.0.20" />
    <PackageReference Include="Microsoft.EntityFrameworkCore" Version="7.0.0" />
    <PackageReference Include="Microsoft.EntityFrameworkCore.Design" Version="7.0.0">
      <IncludeAssets>runtime; build; native; contentfiles; analyzers; buildtransitive</IncludeAssets>
      <PrivateAssets>all</PrivateAssets>
    </PackageReference>
    <PackageReference Include="Microsoft.Extensions.Configuration.Json" Version="7.0.0" />
    <PackageReference Include="Npgsql.EntityFrameworkCore.PostgreSQL" Version="7.0.0" />
    <PackageReference Include="Swashbuckle.AspNetCore" Version="7.2.0" />
  </ItemGroup>

</Project>

================
File: TBLApi.csproj.user
================
<?xml version="1.0" encoding="utf-8"?>
<Project ToolsVersion="Current" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <PropertyGroup>
    <ActiveDebugProfile>https</ActiveDebugProfile>
  </PropertyGroup>
</Project>

================
File: TBLApi.sln
================
Microsoft Visual Studio Solution File, Format Version 12.00
# Visual Studio Version 17
VisualStudioVersion = 17.12.35527.113 d17.12
MinimumVisualStudioVersion = 10.0.40219.1
Project("{FAE04EC0-301F-11D3-BF4B-00C04F79EFBC}") = "TBLApi", "TBLApi.csproj", "{F2F6AAD9-D7E0-4D13-A227-598FEB8056E7}"
EndProject
Global
	GlobalSection(SolutionConfigurationPlatforms) = preSolution
		Debug|Any CPU = Debug|Any CPU
		Release|Any CPU = Release|Any CPU
	EndGlobalSection
	GlobalSection(ProjectConfigurationPlatforms) = postSolution
		{F2F6AAD9-D7E0-4D13-A227-598FEB8056E7}.Debug|Any CPU.ActiveCfg = Debug|Any CPU
		{F2F6AAD9-D7E0-4D13-A227-598FEB8056E7}.Debug|Any CPU.Build.0 = Debug|Any CPU
		{F2F6AAD9-D7E0-4D13-A227-598FEB8056E7}.Release|Any CPU.ActiveCfg = Release|Any CPU
		{F2F6AAD9-D7E0-4D13-A227-598FEB8056E7}.Release|Any CPU.Build.0 = Release|Any CPU
	EndGlobalSection
	GlobalSection(SolutionProperties) = preSolution
		HideSolutionNode = FALSE
	EndGlobalSection
EndGlobal
